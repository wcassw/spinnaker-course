<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui"><title>Spinnaker</title><meta name="author" content="DevelopIntelligence"><link rel="stylesheet" href="reveal.js/css/reset.css"><link rel="stylesheet" href="reveal.js/css/reveal.css"><link rel="stylesheet" href="reveal.js/css/theme/black.css" id="theme"><!--This CSS is generated by the Asciidoctor reveal.js converter to further integrate AsciiDoc's existing semantic with reveal.js--><style type="text/css">.reveal div.right{float:right}

/* listing block */
.reveal .listingblock.stretch>.content{height: 100%}
.reveal .listingblock.stretch>.content>pre{height: 100%}
.reveal .listingblock.stretch>.content>pre>code{height:100%;max-height:100%}

/* tables */
table{border-collapse:collapse;border-spacing:0}
table{margin-bottom:1.25em;border:solid 1px #dedede}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
td.tableblock>.content{margin-bottom:1.25em}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
.reveal table th.halign-left,.reveal table td.halign-left{text-align:left}
.reveal table th.halign-right,.reveal table td.halign-right{text-align:right}
.reveal table th.halign-center,.reveal table td.halign-center{text-align:center}
.reveal table th.valign-top,.reveal table td.valign-top{vertical-align:top}
.reveal table th.valign-bottom,.reveal table td.valign-bottom{vertical-align:bottom}
.reveal table th.valign-middle,.reveal table td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{font-weight:bold}
thead{display:table-header-group}

.reveal table.grid-none th,.reveal table.grid-none td{border-bottom:0!important}

/* kbd macro */
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}

/* callouts */
.conum[data-value] {display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:50%;border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
/* Callout list */
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
/* Disabled from Asciidoctor CSS because it caused callout list to go under the
 * source listing when .stretch is applied (see #335)
 * .literalblock+.colist,.listingblock+.colist{margin-top:-.5em} */
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}

/* Override Asciidoctor CSS that causes issues with reveal.js features */
.reveal .hljs table{border: 0}
/* Callout list rows would have a bottom border with some reveal.js themes (see #335) */
.reveal .colist>table th, .reveal .colist>table td {border-bottom:0}
/* Fixes line height with Highlight.js source listing when linenums enabled (see #331) */
.reveal .hljs table thead tr th, .reveal .hljs table tfoot tr th, .reveal .hljs table tbody tr td, .reveal .hljs table tr td, .reveal .hljs table tfoot tr td{line-height:inherit}

/* Columns layout */
.columns .slide-content {
  display: flex;
}

.columns.wrap .slide-content {
  flex-wrap: wrap;
}

.columns.is-vcentered .slide-content {
  align-items: center;
}

.columns .slide-content > .column {
  display: block;
  flex-basis: 0;
  flex-grow: 1;
  flex-shrink: 1;
  padding: .75rem;
}

.columns .slide-content > .column.is-full {
  flex: none;
  width: 100%;
}

.columns .slide-content > .column.is-four-fifths {
  flex: none;
  width: 80%;
}

.columns .slide-content > .column.is-three-quarters {
  flex: none;
  width: 75%;
}

.columns .slide-content > .column.is-two-thirds {
  flex: none;
  width: 66.6666%;
}

.columns .slide-content > .column.is-three-fifths {
  flex: none;
  width: 60%;
}

.columns .slide-content > .column.is-half {
  flex: none;
  width: 50%;
}

.columns .slide-content > .column.is-two-fifths {
  flex: none;
  width: 40%;
}

.columns .slide-content > .column.is-one-third {
  flex: none;
  width: 33.3333%;
}

.columns .slide-content > .column.is-one-quarter {
  flex: none;
  width: 25%;
}

.columns .slide-content > .column.is-one-fifth {
  flex: none;
  width: 20%;
}
</style><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/v4-shims.min.css"><!--Printing and PDF exports--><script>var link = document.createElement( 'link' );
link.rel = 'stylesheet';
link.type = 'text/css';
link.href = window.location.search.match( /print-pdf/gi ) ? "reveal.js/css/print/pdf.css" : "reveal.js/css/print/paper.css";
document.getElementsByTagName( 'head' )[0].appendChild( link );</script><link rel="stylesheet" href="custom.css"></head><body><div class="reveal"><div class="slides"><section class="title" data-state="title"><h1>Spinnaker</h1><p class="author"><small>DevelopIntelligence</small></p></section><section><section id="_about_developintelligence"><h2>About DevelopIntelligence</h2><div class="slide-content"><div class="imageblock" style=""><img src="./images/about-di.png" alt="about di"></div></div></section><section id="_technologies_we_teach"><h2>Technologies we teach</h2><div class="slide-content"><div class="imageblock" style=""><img src="./images/di-tech.png" alt="di tech"></div></div></section><section id="_our_practitioners"><h2>Our Practitioners</h2><div class="slide-content"><div class="imageblock" style=""><img src="./images/di-practitioners.png" alt="di practitioners"></div></div></section></section>
<section id="_welcome"><div class="slide-content"><div class="imageblock" style=""><img src="./images/checkin.png" alt="checkin"></div>
<div class="paragraph"><p>Please also fill in this poll: <a href="https://forms.gle/MXAjQaNEZEDfsb46A" class="bare">https://forms.gle/MXAjQaNEZEDfsb46A</a></p></div></div></section>
<section><section id="_virtual_training"><h2>Virtual Training</h2><div class="slide-content"><div class="imageblock" style=""><img src="./images/whatwewant.png" alt="whatwewant"></div></div></section><section id="_virtual_training_expectations_for_me"><h2>Virtual Training Expectations For Me</h2><div class="slide-content"><div class="paragraph"><p>I pledge to:</p></div>
<div class="ulist"><ul><li><p>Make this as interesting and interactive as possible</p></li><li><p>Ask questions in order to stimulate discussion</p></li><li><p>Use whatever resources I have at hand to explain the material</p></li><li><p>Try my best to manage verbal responses so that everyone who wants to speak can do so</p></li><li><p>Use an on-screen timer for breaks so you know when to be back</p></li></ul></div></div></section><section id="_virtual_training_expectations_for_you"><h2>Virtual Training Expectations For You</h2><div class="slide-content"><div class="ulist"><ul><li><p>Arrive and Return on Time</p></li><li><p>Mute unless speaking</p></li><li><p>Use chat or ask questions verbally</p></li></ul></div></div></section></section>
<section><section id="_agenda"><h2>Agenda</h2></section><section id="_agenda_2"><h2>Agenda</h2><div class="slide-content"><div class="paragraph"><p>Our <em>mandatory</em> goals for this class:</p></div>
<div class="ulist"><ul><li><p>Become familiar with Spinnaker and it&#8217;s role</p></li><li><p>Understand the UI of Spinnaker</p></li><li><p>Understand an Application, Pipeline, and Stage</p></li><li><p>Purpose of Spinnaker</p></li><li><p>How to get Spinnaker within Salesforce</p></li><li><p>Helm and Baking</p></li><li><p>Spinnaker Expression Language</p></li></ul></div></div></section><section id="_some_other_items_youll_pick_up"><h2>Some Other Items you&#8217;ll Pick Up</h2><div class="slide-content"><div class="ulist"><ul><li><p>Canary</p></li><li><p>Understanding of Kubernetes</p></li><li><p>How it works</p></li><li><p>Debugging Tips</p></li></ul></div></div></section></section>
<section><section id="_continuous_integration_and_delivery"><h2>Continuous Integration and Delivery</h2></section><section id="_continuous_integration"><h2>Continuous Integration</h2><div class="slide-content"><div class="ulist"><ul><li><p>Taking code and integrating and testing with every check in!</p></li><li><p>Employs Continuous Integration (CI) Server</p><div class="ulist"><ul><li><p>Jenkins</p></li><li><p>Bamboo</p></li><li><p>Cruise Control</p></li><li><p>Travis</p></li></ul></div></li></ul></div></div></section><section id="_extending_ci_with_spinnaker"><h2>Extending CI with Spinnaker</h2><div class="slide-content"><div class="ulist"><ul><li><p>Spinnaker takes content created in CI and deploys to staging and production</p></li><li><p>Jenkins could do that to a point:</p><div class="ulist"><ul><li><p>It does not manage multiple servers too well</p></li><li><p>Jenkins (not JenkinsX) doesn&#8217;t work that well with Kubernetes</p></li></ul></div></li></ul></div></div></section><section id="_continuous_integration_2"><h2>Continuous Integration</h2><div class="slide-content"><div class="ulist"><ul><li><p>Tool that monitors version control of changes</p></li><li><p>When a change is detected, the tool will automatically</p><div class="ulist"><ul><li><p>compile</p></li><li><p>test</p></li><li><p>report</p></li></ul></div></li><li><p>Overtime reports on the overall code quality of your project</p></li></ul></div></div></section><section id="_why_continuous_integration"><h2>Why Continuous Integration?</h2><div class="slide-content"><div class="ulist"><ul><li><p>Confidence that a release will perform</p></li><li><p>Fully automated testing</p></li><li><p>Ability to have a "one click" deploy</p></li><li><p>Repeated and reliable</p></li><li><p>Enhances Collaboration Among Developers</p><div class="ulist"><ul><li><p>Builds are no longer secret</p></li><li><p>No longer require the use of deployment expert</p></li></ul></div></li><li><p>Manual building is fairly stupid</p></li><li><p>Process seen in action! You know if it works or doesn&#8217;t</p></li></ul></div></div></section><section id="_purpose_of_a_ci_server"><h2>Purpose of a CI Server</h2><div class="slide-content"><div class="ulist"><ul><li><p>Configured to watch your version control system</p></li><li><p>Check out or update your source code every time a change is made</p></li><li><p>Run the automated build process</p></li><li><p>Store the binaries where they are accessible to the whole team</p></li><li><p>Reducing risk by providing faster feedback</p></li><li><p>Identify and fix integration and regression issues faster</p></li></ul></div></div></section><section id="_how_does_ci_improve_software_quality"><h2>How does CI Improve Software Quality</h2><div class="slide-content"><div class="ulist"><ul><li><p>Everyone has information on the build at every single moment</p></li><li><p>Developers are aware of the constant change in their project</p></li><li><p>Notifications to all Developers when the build fails</p></li></ul></div></div></section><section id="_provide_value_to_the_end_user_faster"><h2>Provide Value to the End User Faster</h2><div class="slide-content"><div class="ulist"><ul><li><p>Ensures that software is build, tested, and maintained regularly</p></li><li><p>There is always a deployment of some kind</p></li><li><p>Deployments are no longer magical mystery events that happen every month</p></li></ul></div></div></section><section id="_empowering_teams"><h2>Empowering Teams</h2><div class="slide-content"><div class="ulist"><ul><li><p>Continuous Integration can deploy onto the servers themselves.</p></li><li><p>Power to real time view results</p></li><li><p>There will be no longer the uber-operations-specialist</p></li><li><p>Expand the role of the developer include operations.</p></li></ul></div></div></section><section id="_reducing_errors"><h2>Reducing Errors</h2><div class="slide-content"><div class="ulist"><ul><li><p>Ensures the correct version, configuration, database schema, etc. are applied the same way every time through automation</p></li><li><p>Staging areas are equivalent to production areas</p></li><li><p>Less surprises.</p></li><li><p>No more hidden configuration that we don’t know about at production time</p></li></ul></div></div></section><section id="_lowers_stress"><h2>Lowers Stress</h2><div class="slide-content"><div class="ulist"><ul><li><p>A Release becomes commonplace without the typical stress</p></li><li><p>No weekend battles</p></li><li><p>Less embarrassing releases</p></li><li><p>Rollback versions easily to a well known build</p></li></ul></div></div></section><section id="_deployment_flexibility"><h2>Deployment Flexibility</h2><div class="slide-content"><div class="ulist"><ul><li><p>Instantiate a new environment or configuration by making a few changes to the automated delivery system.</p></li><li><p>Create multiple version of environments</p></li></ul></div></div></section><section id="_practice_makes_perfect"><h2>Practice Makes Perfect</h2><div class="slide-content"><div class="ulist"><ul><li><p>Final deployment into production is being rehearsed every single time the software is deployed to any target environments.</p></li><li><p>Overtime deployment becomes standard practice</p></li><li><p>Check in frequently</p></li><li><p>Don’t check in broken code</p></li><li><p>Don’t check in untested code</p></li><li><p>Don’t check in when the build is broken</p></li><li><p>Don’t go home after checking in until the system builds</p></li><li><p>Every Check in is a potential release!</p></li></ul></div></div></section><section id="_will_it_happen_overnight"><h2>Will it happen overnight?</h2><div class="slide-content"><div class="ulist"><ul><li><p>It will take time for all those invested</p></li><li><p>Testing will have to be commonplace</p></li><li><p>Commitments in code will have to be small</p></li><li><p>Behaviors and rituals will need to change</p></li></ul></div></div></section><section id="_how_does_ci_help_release_on_time"><h2>How does CI help release on time?</h2><div class="slide-content"><div class="ulist"><ul><li><p>Automation, Automation, Automation, Automation</p></li><li><p>Humans are slow, why not let computers do the work?</p></li><li><p>Problems no longer are debt: If anything fails it must be fixed immediately</p></li><li><p>Bugs, along with testing, are squashed oftentimes permanently!</p></li><li><p>Lessens the fear of "integration hell"</p></li><li><p>Lessens the fear of production deployment!</p></li></ul></div></div></section><section id="_future_is_here"><h2>Future is Here</h2><div class="slide-content"><div class="ulist"><ul><li><p>Spinnaker, Jenkins, and Kubernetes allows for IaC (Infrastructure as Code)</p></li><li><p>Continuous Integration is committed as code, using <code>Jenkinsfile</code></p></li><li><p>Kuberenetes <code>replicaSet</code>, <code>deployment</code>, <code>ingress</code>, etc are all <code>yaml</code> files</p></li><li><p>Spinnaker can use these files to deploy fleet of systems</p></li></ul></div></div></section></section>
<section><section id="_kubernetes"><h2>Kubernetes</h2></section><section id="_kubernetes_node_port_and_cluster_ip"><h2>Kubernetes Node Port and Cluster IP</h2><div class="slide-content"><div class="imageblock" style=""><img src="https://i0.wp.com/www.docker.com/blog/wp-content/uploads/2019/09/Kubernetes-NodePort-Service-2.png?w=1069&ssl=1" alt="Kubernetes NodePort Service 2"></div></div></section><section id="_3_tier_architecture"><h2>3-tier Architecture</h2><div class="slide-content"><div class="imageblock" style=""><img src="./images/3-tier.png" alt="3 tier"></div></div></section><section id="_review_of_resources"><h2>Review of Resources</h2></section><section id="_pod"><h2>Pod</h2><div class="slide-content"><div class="ulist"><ul><li><p>Group of one or more containers (such as Docker containers)</p></li><li><p>Shared storage/network</p></li><li><p>Specification for how to run the containers</p></li></ul></div></div></section><section id="_service"><h2>Service</h2><div class="slide-content"><div class="ulist"><ul><li><p>Service is an abstraction which defines a logical set of Pods and a policy by which to access them</p></li><li><p>Sometimes this pattern is called a micro-service).</p></li><li><p>The set of Pods targeted by a Service is usually determined by a selector</p></li></ul></div></div></section><section id="_deployment"><h2>Deployment</h2><div class="slide-content"><div class="ulist"><ul><li><p>Provides declarative updates for Pods and ReplicaSets.</p></li><li><p>Describe a desired state in a Deployment</p></li><li><p>Deployment Controller changes the actual state to the desired state at a controlled rate.</p></li><li><p>You can define Deployments to create new ReplicaSets,</p></li><li><p>Or remove existing Deployments and adopt all their resources with new Deployment</p></li></ul></div></div></section><section id="_configmap"><h2>ConfigMap</h2><div class="slide-content"><div class="ulist"><ul><li><p>Bind to your Pods' containers and system components at runtime</p><div class="ulist"><ul><li><p>Configuration files</p></li><li><p>Command-line arguments</p></li><li><p>Environment variables</p></li><li><p>Port numbers</p></li><li><p>Other configuration artifacts</p></li></ul></div></li><li><p>Enable you to separate your configurations from your Pods and components, making workloads portable.</p></li></ul></div></div></section><section id="_serviceaccount"><h2>ServiceAccount</h2><div class="slide-content"><div class="ulist"><ul><li><p>Service accounts are users managed by the Kubernetes API.</p></li><li><p>They are bound to specific namespaces, and created automatically by the API server or manually through API calls.</p></li><li><p>Service accounts are tied to a set of credentials stored as Secrets</p></li></ul></div></div></section><section id="_ingress"><h2>Ingress</h2><div class="slide-content"><div class="ulist"><ul><li><p>Object defines rules for routing HTTP(S) traffic to applications running in a cluster.</p></li><li><p>An Ingress object is associated with one or more Service objects</p></li><li><p>Each Service is associated with a set of Pods</p></li></ul></div></div></section><section id="_kubernetes_and_ingress"><h2>Kubernetes and Ingress</h2><div class="slide-content"><div class="imageblock" style=""><img src="https://d2908q01vomqb2.cloudfront.net/ca3512f4dfa95a03169c5a670a4c91a19b3077b4/2018/11/20/image1-1.png" alt="image1 1"></div></div></section></section>
<section><section id="_overview"><h2>Overview</h2></section><section id="_what_is_spinnaker"><h2>What is Spinnaker?</h2><div class="slide-content"><div class="ulist"><ul><li><p>Open Source, Multicloud Platform</p></li><li><p>Release Software at high velocity and confidence</p></li><li><p>Extends where Jenkins CI leaves off</p></li><li><p>Manages Staging and Deployment</p></li><li><p>Makes use of containers</p></li><li><p>Provides Baking Ability and Canary Ability</p></li></ul></div></div></section><section id="_applications"><h2>Applications</h2><div class="slide-content"><div class="ulist"><ul><li><p>Represents the service which you are going to deploy using Spinnaker</p></li><li><p>It is the center of your universe in regards to your application</p></li><li><p>Contains all configuration for that service, and all the infrastructure on which it will run</p></li><li><p>You will typically create a different application for each service</p></li></ul></div></div></section><section id="_inside_the_application"><h2>Inside the Application</h2><div class="slide-content"><div class="ulist"><ul><li><p>Firewalls</p></li><li><p>Load Balancers</p></li><li><p>Clusters of Services or Deployments</p></li><li><p>Server Groups</p></li><li><p>Canary Configurations</p></li></ul></div></div></section><section id="_clusters"><h2>Clusters</h2><div class="slide-content"><div class="ulist"><ul><li><p>Logical Groups of Server Groups</p></li><li><p>Does not map to a Kubernetes Cluster</p></li><li><p>It <em>does</em> map to a Kubernetes <em>Deployment</em></p></li></ul></div>
<div class="imageblock" style=""><img src="./images/overview_cluster.png" alt="overview cluster" width="80%" height="80%"></div>
<div class="paragraph"><p>Source: <a href="https://www.spinnaker.io/reference/providers/kubernetes/#cluster" class="bare">https://www.spinnaker.io/reference/providers/kubernetes/#cluster</a></p></div></div></section><section id="_server_group"><h2>Server Group</h2><div class="slide-content"><div class="ulist"><ul><li><p>Collection of Instances</p></li><li><p>With Basic Configuration Settings</p><div class="ulist"><ul><li><p>Number of Instances</p></li><li><p>Autoscaling Policies</p></li><li><p>Their Metadata</p></li></ul></div></li></ul></div></div></section><section id="_deployment_highlighted"><h2>Deployment Highlighted</h2><div class="slide-content"><div class="imageblock" style=""><img src="./images/deployment-overview.png" alt="deployment overview"></div><div class="title">Figure 1. The Deployment is highlighted</div></div></section><section id="_replica_set_highlighted"><h2>Replica Set Highlighted</h2><div class="slide-content"><div class="imageblock" style=""><img src="./images/replica-set-overview.png" alt="replica set overview"></div><div class="title">Figure 2. The Replica Set is highlighted</div></div></section><section id="_replica_set_history"><h2>Replica Set History</h2><div class="slide-content"><div class="ulist"><ul><li><p>With deployments history of the deployments are maintained</p></li><li><p>The following shows a history</p></li><li><p>Deployments can be:</p><div class="ulist"><ul><li><p><em>rolled back</em></p></li><li><p><em>deleted</em></p></li><li><p><em>restarted</em></p></li><li><p><em>scaled</em></p></li></ul></div></li></ul></div></div></section><section id="_replica_set_history_2"><h2>Replica Set History</h2><div class="slide-content"><div class="imageblock" style=""><img src="./images/deployment-history.png" alt="deployment history"></div></div></section><section id="_load_balancers"><h2>Load Balancers</h2><div class="slide-content"><div class="ulist"><ul><li><p>Load Balancer is associated with:</p><div class="ulist"><ul><li><p>An ingress protocol</p></li><li><p>Port range</p></li></ul></div></li><li><p>It corresponds to a Kubernetes <em>Service</em></p></li><li><p>It balances traffic among instances in its Server Groups.</p></li><li><p>You can enable health checks for a load balancer</p></li><li><p>Flexibility to define health criteria and specify the health check endpoint.</p></li></ul></div></div></section><section id="_load_balancing"><h2>Load Balancing</h2><div class="slide-content"><div class="imageblock" style=""><img src="./images/overview_load_balancer.png" alt="overview load balancer" width="80%" height="80%"></div></div></section><section id="_load_balancing_with_ingress"><h2>Load Balancing with Ingress</h2><div class="slide-content"><div class="paragraph"><p>The following shows the ingress protocol</p></div>
<div class="imageblock" style=""><img src="./images/overview_ingress.png" alt="overview ingress"></div></div></section><section id="_firewalls"><h2>Firewalls</h2><div class="slide-content"><div class="ulist"><ul><li><p>Firewall defines network traffic access</p></li><li><p>Firewall rules defined by an IP range (CIDR) along with a communication protocol (e.g., TCP) and port range</p></li><li><p>It is associated with Kubernetes Network Policies</p></li></ul></div>
<div class="paragraph"><p>Source: <a href="https://www.spinnaker.io/reference/providers/kubernetes-v2/#networkpolicies" class="bare">https://www.spinnaker.io/reference/providers/kubernetes-v2/#networkpolicies</a></p></div></div></section><section id="_pipeline"><h2>Pipeline</h2><div class="slide-content"><div class="imageblock" style=""><img src="./images/overview_pipeline.png" alt="overview pipeline"></div>
<div class="ulist"><ul><li><p>Key deployment management construct in Spinnaker</p></li><li><p>Manage deployments in a consistent, repeatable and safe way.</p></li><li><p>Consists of a sequence of actions, known as <em>stages</em></p></li><li><p>Possibility to pass parameters from stage to stage along the pipeline</p></li></ul></div></div></section><section id="_pipelines_continued"><h2>Pipelines Continued</h2><div class="slide-content"><div class="imageblock" style=""><img src="./images/overview_pipeline.png" alt="overview pipeline"></div>
<div class="ulist"><ul><li><p>Includes <em>scaffolding functions</em> (manual judgment, wait, run Jenkins job) that together precisely defines your runbook for managing your deployments</p></li><li><p>Started manually or triggered by an event:</p><div class="ulist"><ul><li><p><code>git push</code></p></li><li><p>Docker image upload</p></li><li><p>CRON Schedule</p></li></ul></div></li><li><p>You can emit notifications</p></li></ul></div></div></section><section id="_pipeline_anatomy"><h2>Pipeline Anatomy</h2><div class="slide-content"><div class="ulist"><ul><li><p>Define your sequence of stages at the top.</p></li><li><p>Spinnaker supports parallel paths of stages, as well as the ability to specify whether multiple instances of a pipeline can be run at once.</p></li><li><p>Specify details for a given stage in the sections underneath the pipeline.</p></li></ul></div>
<div class="imageblock" style=""><img src="https://www.spinnaker.io/concepts/pipelines/edit-pipeline.png" alt="edit pipeline" width="75%" height="75%"></div></div></section><section id="_viewing_pipeline_execution_history"><h2>Viewing Pipeline Execution History</h2><div class="slide-content"><div class="ulist"><ul><li><p>Serves as a means to introspect details of each deployment operation</p></li><li><p>An effective audit log of enforced processes/policies on how you make changes to your deployed applications landscape.</p></li></ul></div>
<div class="imageblock" style=""><img src="./images/pipeline_execution.png" alt="pipeline execution"></div></div></section><section id="_stage"><h2>Stage</h2><div class="slide-content"><div class="imageblock" style=""><img src="./images/overview_stage.png" alt="overview stage"></div>
<div class="ulist"><ul><li><p>Atomic building block for a pipeline</p></li><li><p>Sequenced to form a pipeline</p></li><li><p>Spinnaker provides multiple stages:</p><div class="ulist"><ul><li><p>Deploy</p></li><li><p>Resize</p></li><li><p>Disable</p></li><li><p>Manual Judgment</p></li></ul></div></li></ul></div>
<div class="paragraph"><p><a href="https://www.spinnaker.io/reference/pipeline/stages/" class="bare">https://www.spinnaker.io/reference/pipeline/stages/</a></p></div></div></section><section id="_one_stage_multiple_steps_one_step_multiple_actions"><h2>One Stage, Multiple Steps; One Step, Multiple Actions</h2><div class="slide-content"><div class="imageblock" style=""><img src="https://www.spinnaker.io/concepts/pipelines/pipeline-tasks.png" alt="pipeline tasks"></div>
<div class="ulist"><ul><li><p>Automation does not end with orchestrating only the high-level steps of your release process</p></li><li><p>Each of these operational steps often corresponds to a sequence of calls to the cloud platform</p></li><li><p>Each of which needs to be remediated in failure scenarios</p></li><li><p>The red/black Deploy stage is an example of how Spinnaker fully supports this notion</p></li></ul></div></div></section><section id="_breaking_down_the_stage"><h2>Breaking Down the Stage</h2><div class="slide-content"><div class="imageblock" style=""><img src="https://www.spinnaker.io/concepts/pipelines/pipeline-tasks.png" alt="pipeline tasks"></div>
<div class="ulist"><ul><li><p>The Red/Black Deploy stage in Spinnaker actually entails a sequence of steps</p></li><li><p>Each given step is actually a set of tasks that need polling, remediation to ensure requisite state is reached prior to proceeding</p></li><li><p>A given task often entails multiple API calls to the specific cloud platform, cognizant of expected response codes and remediating actions in failure</p></li></ul></div></div></section><section id="_clusters_2"><h2>Clusters</h2><div class="slide-content"><div class="paragraph"><p>Source: <a href="https://www.spinnaker.io/concepts/clusters/" class="bare">https://www.spinnaker.io/concepts/clusters/</a></p></div>
<div class="imageblock" style=""><img src="./images/overview_clusters.png" alt="overview clusters"></div></div></section><section id="_cluster_definition"><h2>Cluster Definition</h2><div class="slide-content"><div class="ulist"><ul><li><p>Spinnaker acts as a single pane of glass from which to manage your global deployments across multiple clouds!</p></li><li><p>Contains information related to:</p><div class="ulist"><ul><li><p>Health and status of running environments</p></li><li><p>Metadata around deployments and individual instances</p></li></ul></div></li><li><p>Also ability to perform ad-hoc actions you can perform on the resources you see such:</p><div class="ulist"><ul><li><p>resize</p></li><li><p>clone</p></li><li><p>disable</p></li><li><p>roll back</p></li></ul></div></li></ul></div></div></section><section id="_left_pane" class="columns"><h2>Left Pane</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="imageblock" style=""><img src="./images/overview_clusters.png" alt="overview clusters"></div></div></div>
<div class="openblock column"><div class="content"><div class="ulist"><ul><li><p>Filters for viewing your deployed services.</p></li><li><p>Search by string match, or narrow by specific attributes of your services,such as:</p><div class="ulist"><ul><li><p>Cloud platform</p></li><li><p>Region</p></li><li><p>Designated environments and stacks.</p></li></ul></div></li></ul></div></div></div></div></section><section id="_main_pane" class="columns"><h2>Main Pane</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="imageblock" style=""><img src="./images/overview_clusters.png" alt="overview clusters"></div></div></div>
<div class="openblock column"><div class="content"><div class="ulist"><ul><li><p>Lists the deployed services.</p></li><li><p>Green chiclets are individual instances (pods)</p></li><li><p>All grouped into Server Groups (a particular deployment)</p></li></ul></div></div></div></div></section><section id="_right_pane" class="columns"><h2>Right Pane</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="imageblock" style=""><img src="./images/overview_clusters.png" alt="overview clusters"></div></div></div>
<div class="openblock column"><div class="content"><div class="ulist"><ul><li><p>Provides details for the item currently selected in the center section</p></li><li><p>For each item, Spinnaker provides details related to both application-level concerns (Jenkins job details) as well as infrastructure-level concerns (machine type, auto-scaling policies).</p></li></ul></div></div></div></div></section><section id="_spinnaker_process"><h2>Spinnaker Process</h2><div class="slide-content"><div class="olist arabic"><ol class="arabic"><li><p>Create an Application</p><div class="ulist"><ul><li><p>One Application per Microservice</p></li></ul></div></li><li><p>Define your Infrastructure</p><div class="ulist"><ul><li><p>Define infrastructure for each application</p></li><li><p>Pipelines deploy services to the server groups you define</p></li><li><p>NOTE: Not necessary since you can define infrastructure from pipeline</p></li></ul></div></li><li><p>Create a Pipeline</p><div class="ulist"><ul><li><p>Create all the pipelines needed to deploy the service or services covered by the application</p></li></ul></div></li><li><p>Run your Pipeline</p><div class="ulist"><ul><li><p>Automatic</p></li><li><p>Triggered</p></li></ul></div></li></ol></div>
<div class="paragraph"><p>Source: <a href="https://www.spinnaker.io/guides/user/get-started/" class="bare">https://www.spinnaker.io/guides/user/get-started/</a></p></div></div></section><section id="_cloud_providers"><h2>Cloud Providers</h2></section><section id="_overview_2"><h2>Overview</h2><div class="slide-content"><div class="ulist"><ul><li><p>A Cloud Provider is an interface to a set of virtual resources that Spinnaker has control over.</p></li><li><p>Typically, this is a IaaS provider, like AWS, or GCP</p></li><li><p>It can also be a PaaS, like App Engine, or a container Orchestrator, like Kubernetes.</p></li><li><p>The cloud provider is central to everything you do in Spinnaker.</p><div class="ulist"><ul><li><p>It’s where you deploy your Server Groups, the source of your deployable artifacts</p></li><li><p>and the subject of automation via Pipelines.</p></li></ul></div></li></ul></div></div></section><section id="_accounts"><h2>Accounts</h2><div class="slide-content"><div class="ulist"><ul><li><p>An Account is a named credential Spinnaker uses to authenticate against a cloud provider.</p></li><li><p>Each provider has slightly different requirements for what format credentials can be in, and what permissions they need to have afforded to them.</p></li><li><p>Each Supported Provider has their own way to create an account and register the credentials with <strong>Halyard</strong>.</p></li><li><p>Keep in mind that every Provider can have as many accounts added as desired</p><div class="ulist"><ul><li><p>This will allow you to keep your environments (e.g. staging vs. prod):</p><div class="ulist"><ul><li><p>Separate</p></li><li><p>Restrict access to sets of resources using Spinnaker’s Authorization mechanisms</p></li></ul></div></li></ul></div></li></ul></div></div></section><section id="_cloud_providers_supported"><h2>Cloud Providers Supported</h2><div class="slide-content"><div class="ulist"><ul><li><p>App Engine</p></li><li><p>Amazon Web Services</p></li><li><p>Azure</p></li><li><p>Cloud Foundry</p></li><li><p>DC/OS</p></li><li><p>Docker v2 Registry (Note: This only acts as a source of images, and does not include support for deploying Docker images)</p></li><li><p>Google Compute Engine</p></li><li><p>Kubernetes</p></li><li><p>Oracle</p></li></ul></div></div></section></section>
<section><section id="_deploying_microservices"><h2>Deploying Microservices</h2></section><section id="_the_process"><h2>The Process</h2><div class="slide-content"><div class="imageblock" style=""><img src="./images/process.png" alt="process"></div></div></section><section id="_the_steps"><h2>The Steps</h2><div class="slide-content"><div class="olist arabic"><ol class="arabic"><li><p>Setup a repository for a microservice</p></li><li><p>Setup a CI application to run unit integration tests</p></li><li><p>Create an Spinnaker Application</p></li><li><p>Define the Infrastructure</p></li><li><p>Create a Pipeline</p></li><li><p>Run your Pipeline</p></li></ol></div>
<div class="paragraph"><p>Source: <a href="https://www.spinnaker.io/guides/user/get-started/" class="bare">https://www.spinnaker.io/guides/user/get-started/</a></p></div></div></section><section id="_create_an_application"><h2>Create an Application</h2><div class="slide-content"><div class="ulist"><ul><li><p>One Application per Microservice</p></li><li><p>This is the root where we will begin</p></li><li><p>Note that your application configuration affects what you can do with Spinnaker—you can enable or disable some Spinnaker features.</p></li></ul></div></div></section><section id="_about_an_application"><h2>About an Application</h2><div class="slide-content"><div class="ulist"><ul><li><p>An application in Spinnaker is a construct that represents some service that you are going to deploy (typically a microservice).</p></li><li><p>It includes:</p><div class="ulist"><ul><li><p>The pipelines that process the service through to deployment in production</p></li><li><p>The infrastructure on which the service is run:</p><div class="ulist"><ul><li><p>Clusters</p></li><li><p>Server Groups</p></li><li><p>Firewalls</p></li><li><p>Load Balancers</p></li><li><p>Canary Configs</p></li></ul></div></li></ul></div></li></ul></div></div></section><section id="_creating_the_application"><h2>Creating the Application</h2><div class="slide-content"><div class="imageblock" style=""><img src="./images/create_application_action.png" alt="create application action"></div>
<div class="ulist"><ul><li><p>You can’t create a deployment pipeline unless you have an application to put it in.</p></li><li><p>Click on the <strong>Applications</strong> tab</p></li><li><p>Click on Create Application</p></li></ul></div></div></section><section id="_entering_application_attributes"><h2>Entering Application Attributes</h2><div class="slide-content"><div class="ulist"><ul><li><p>Provide the attributes for the new Application</p></li><li><p>Click <strong>Create</strong></p></li></ul></div>
<div class="imageblock" style="text-align: center"><img src="./images/create_application.png" alt="create application" width="50%" height="50%"></div></div></section><section id="_more_application_attributes"><h2>More Application Attributes</h2><div class="slide-content"><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:16.6666%"><col style="width:16.6666%"><col style="width:66.6668%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Field</th><th class="tableblock halign-left valign-top">Required</th><th class="tableblock halign-left valign-top">Description</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>Name</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">A unique name to identify this application.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>Owner Email</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The email address of the owner of this application, within your installation of Spinnaker.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>Repo type</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The platform hosting the code repository for this application. Stash, Bitbucket, or GitHub.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>Description</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Use this text field to describe the application, if necessary.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>Consider only cloud provider health</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Bool, default=no</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">If enabled, instance status as reported by the cloud provider is considered sufficient to determine task completion. When disabled, tasks need health status reported by some other health provider (load balancer, discovery service).</p></td></tr></table></div></section><section id="_application_attributes_continued"><h2>Application Attributes Continued</h2><div class="slide-content"><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:16.6666%"><col style="width:16.6666%"><col style="width:66.6668%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Field</th><th class="tableblock halign-left valign-top">Required</th><th class="tableblock halign-left valign-top">Description</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>Show health override option</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Bool, default=no</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">If enabled, users can toggle previous option per task.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>Instance port</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">This field is used to generate links from Spinnaker instance details to a running instance. The instance port can be used or overridden for specific links configured for your application (via the Config screen).</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>Enable restarting running pipelines</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Bool, default=no</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">If enabled, users can restart pipeline stages while a pipeline is still running. This behavior is not recommended.</p></td></tr></table></div></section><section id="_editing_the_configuration" class="columns"><h2>Editing the Configuration</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="paragraph"><p>If you need to go back and edit your configuration you can hit the config button on the upper right hand side</p></div>
<div class="imageblock" style=""><img src="./images/config_small_button.png" alt="config small button" width="40%" height="40%"></div></div></div>
<div class="openblock column"><div class="content"><div class="paragraph"><p>The Configuration has some of the following sections:</p></div>
<div class="ulist"><ul><li><p>Edit Notifications</p></li><li><p>Features</p></li><li><p>Links</p></li><li><p>Traffic Guards</p></li><li><p>Custom Banners</p></li><li><p>Delete Application</p></li></ul></div></div></div></div></section><section id="_editing_notifications" class="columns"><h2>Editing Notifications</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="paragraph"><p>Spinnaker can send notification for any application and are optional</p></div>
<div class="paragraph"><p>Click <strong>Add Notification Preferences</strong></p></div></div></div>
<div class="openblock column"><div class="content"><div class="imageblock" style="text-align: center"><img src="./images/event_notification_prefs.png" alt="event notification prefs"></div></div></div></div></section><section id="_selecting_the_notification_medium" class="columns"><h2>Selecting the Notification Medium</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="ulist"><ul><li><p>Select the notification medium:</p><div class="ulist"><ul><li><p>Email</p></li><li><p>SMS</p></li><li><p>Slack</p></li></ul></div></li></ul></div></div></div>
<div class="openblock column"><div class="content"><div class="imageblock" style="text-align: center"><img src="./images/event_notification_prefs.png" alt="event notification prefs"></div></div></div></div></section><section id="_editing_notifications_2" class="columns"><h2>Editing Notifications</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="ulist"><ul><li><p>Provide the information for the type you chose:</p><div class="ulist"><ul><li><p>Email address</p></li><li><p>Phone number</p></li><li><p>Slack Members</p></li></ul></div></li></ul></div></div></div>
<div class="openblock column"><div class="content"><div class="imageblock" style="text-align: center"><img src="./images/event_notification_prefs.png" alt="event notification prefs"></div></div></div></div></section><section id="_pipeline_events" class="columns"><h2>Pipeline Events</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="paragraph"><p>For each event, enter any custom text you want included in the notification.</p></div>
<div class="ulist"><ul><li><p>A pipeline started</p></li><li><p>A pipeline finished</p></li><li><p>A pipeline failed</p></li></ul></div></div></div>
<div class="openblock column"><div class="content"><div class="imageblock" style="text-align: center"><img src="./images/event_notification_prefs.png" alt="event notification prefs"></div></div></div></div></section><section id="_update_and_adding_notifications" class="columns"><h2>Update and Adding Notifications</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="olist arabic"><ol class="arabic"><li><p>Click <strong>Update</strong></p></li><li><p>Repeat these steps to add more notifications, if you want.</p></li><li><p>Click <strong>Edit</strong> next to any existing notification to change its preferences, or click <strong>Remove</strong> to delete it.</p></li></ol></div></div></div>
<div class="openblock column"><div class="content"><div class="imageblock" style="text-align: center"><img src="./images/event_notification_prefs.png" alt="event notification prefs"></div></div></div></div></section><section id="_enabling_features_in_spinnaker"><h2>Enabling Features in Spinnaker</h2><div class="slide-content"><div class="paragraph"><p>In order to not allow Spinnaker from annoying you about resources you don&#8217;t use you can turn them off</p></div>
<div class="imageblock" style="text-align: center"><img src="./images/features_panel.png" alt="features panel"></div></div></section><section id="_custom_links"><h2>Custom Links</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can include custom links to the instance details panel, providing shortcuts to information related to the instance, like logs, health, and so on.</p></li><li><p>It currently doesn&#8217;t work with Kubernetes resources unless exposed from cluster</p></li></ul></div>
<div class="imageblock" style="text-align: center"><img src="./images/custom_links.png" alt="custom links"></div></div></section><section id="_custom_link_process"><h2>Custom Link Process</h2><div class="slide-content"><div class="olist arabic"><ol class="arabic"><li><p>In the <strong>Links</strong> section, click <strong>Add Section</strong></p></li><li><p>Provide text for the new <strong>Section heading</strong>.</p></li><li><p>In the <strong>Links</strong> fields, type the text that you want to display, and the path to the link target.</p></li><li><p>You can reference these specific instance attributes by wrapping them in curly braces. For example, to include the region where the instance lives, for a GCE or AWS instance, use <code>{region}</code>. These are for the path only, not the link display text.</p></li><li><p>Click <strong>Add Link</strong> for each additional link you want displayed in this section.</p></li><li><p>Click <strong>Add Section</strong> for any additional sections.</p></li><li><p>Click <strong>Revert</strong> to clear your work in progress.</p></li><li><p>This does not remove any saved custom instance links.</p></li><li><p>Click <strong>Save Changes</strong> when you’re finished.</p></li></ol></div></div></section><section id="_traffic_guards"><h2>Traffic Guards</h2><div class="slide-content"><div class="imageblock" style="text-align: center"><img src="./images/traffic_guards.png" alt="traffic guards"></div>
<div class="ulist"><ul><li><p>A traffic guard is a cluster which you have designated as always having at least one active instance.</p></li><li><p>With traffic guard enabled, if a user or process tries to delete, disable, or resize the server group, Spinnaker will verify the operation will not leave the cluster with no active instances, and fail the operation if it would.</p></li></ul></div></div></section><section id="_traffic_guard_process"><h2>Traffic Guard Process</h2><div class="slide-content"><div class="paragraph"><p>In the Traffic Guards section:</p></div>
<div class="ulist"><ul><li><p>Click <strong>Add Traffic Guard</strong></p></li><li><p>Set the following values as seen in table below</p></li><li><p>Click <strong>Save Changes</strong> to apply your new traffic guard, or changes to an existing one</p></li></ul></div>
<table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:20%"><col style="width:20%"><col style="width:60%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Field</th><th class="tableblock halign-left valign-top">Required?</th><th class="tableblock halign-left valign-top">Description</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Account</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The account for which you’re setting up the traffic guard</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Region</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The applicable region from the list, or * for all</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Stack</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The stack to which to apply this traffic guard. Leave blank to apply the guard only to a cluster that has no stack.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Detail</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The detail string necessary to identify this cluster via the application-stack-detail naming convention</p></td></tr></table></div></section><section id="_custom_banners"><h2>Custom Banners</h2><div class="slide-content"><div class="imageblock" style=""><img src="./images/banner.png" alt="banner"></div></div></section><section id="_custom_banner_process"><h2>Custom Banner Process</h2><div class="slide-content"><div class="paragraph"><p>You can create simple text based banners</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Click <strong>Add Banner</strong></p></li><li><p>Click <strong>Enable</strong> to enable the banner</p></li><li><p>Select a text color for the foreground color</p></li><li><p>Select a background color for the background color</p></li></ol></div></div></section><section id="_define_the_infrastructure_the_service_will_run"><h2>Define the Infrastructure the Service will run</h2><div class="slide-content"><div class="ulist"><ul><li><p>You define infrastructure for each application.</p></li><li><p>Your pipelines deploys services to the server groups you define.</p></li><li><p>This means that production environments can be deployed without a pipeline.</p></li><li><p>This will provide you with the initial production environement</p></li></ul></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">this step is not a prerequisite for creating pipelines. In fact, you can use pipelines to create infrastructure.</td></tr></table></div></div></section><section id="_pipelines"><h2>Pipelines</h2><div class="slide-content"><div class="ulist"><ul><li><p>How we control and deploy our application</p></li><li><p>Series of stages that can be combined in any order</p></li><li><p>Can be automatic or manual</p></li><li><p>Triggered by a wide arrange of inputs</p></li></ul></div></div></section><section id="_create_a_pipeline"><h2>Create a Pipeline</h2><div class="slide-content"><div class="ulist"><ul><li><p>After creating the Application, navigate the <strong>Pipelines</strong> tab in your navigation</p><div class="ulist"><ul><li><p>Name your pipeline</p></li><li><p>Then add stages</p></li></ul></div></li></ul></div>
<div class="imageblock" style=""><img src="https://www.spinnaker.io/guides/user/pipeline/managing-pipelines/images/create.png" alt="create"></div></div></section><section id="_configuration_stage"><h2>Configuration Stage</h2><div class="slide-content"><div class="ulist"><ul><li><p>The initial stage that you are provided is the configuration stage</p></li><li><p>It is where we define:</p><div class="ulist"><ul><li><p><em>expected artifacts</em></p></li><li><p><em>triggers</em></p></li><li><p><em>parameters</em></p></li><li><p><em>notifications</em></p></li></ul></div></li></ul></div></div></section><section id="_adding_stages"><h2>Adding Stages</h2><div class="slide-content"><div class="imageblock" style=""><img src="https://www.spinnaker.io/guides/user/pipeline/managing-pipelines/images/add-stage.png" alt="add stage"></div></div></section><section id="_adding_stage_process"><h2>Adding Stage Process</h2><div class="slide-content"><div class="ulist"><ul><li><p>The first step in any pipeline is <strong>Configuration</strong>, where you can set up pipeline triggers and parameters.</p></li><li><p>Each stage specifies an action the pipeline will take once it’s configured.</p></li><li><p>The steps include</p><div class="ulist"><ul><li><p>Select Add stage from your pipeline configuration screen.</p></li><li><p>Set the stage type using the drop-down menu.</p></li></ul></div></li></ul></div></div></section><section id="_stage_depends_on"><h2>Stage Depends On</h2><div class="slide-content"><div class="paragraph"><p>If this isn’t the first stage in your pipeline, make sure that this stage depends on the desired upstream stage(s) using the Depends on field.</p></div>
<div class="imageblock" style=""><img src="https://www.spinnaker.io/guides/user/pipeline/managing-pipelines/images/stage-depends-on.png" alt="stage depends on"></div></div></section><section id="_manually_run_your_pipeline"><h2>Manually Run your Pipeline</h2><div class="slide-content"><div class="paragraph"><p>You can run a pipeline manually, but most pipelines are triggered automatically.
If you so care to, particularly if you don&#8217;t want to redo the build, you can click on <strong>Start Manual Execution</strong></p></div>
<div class="imageblock" style=""><img src="https://www.spinnaker.io/guides/user/pipeline/managing-pipelines/images/manual-execution.png" alt="manual execution"></div></div></section><section id="_application_deployment"><h2>Application Deployment</h2><div class="slide-content"><div class="imageblock" style=""><img src="https://www.spinnaker.io/concepts/pipelines.png" alt="pipelines"></div></div></section><section id="_disabling_a_pipeline"><h2>Disabling a Pipeline</h2><div class="slide-content"><div class="ulist"><ul><li><p>From the Pipelines tab, click <strong>Configure</strong> to modify an existing pipeline</p></li><li><p>Click Pipeline actions in the upper right corner, and select <strong>Disable</strong>.</p></li></ul></div>
<div class="imageblock" style=""><img src="https://www.spinnaker.io/guides/user/pipeline/managing-pipelines/images/pipeline-actions.png" alt="pipeline actions"></div></div></section><section id="_deleting_a_pipeline"><h2>Deleting a Pipeline</h2><div class="slide-content"><div class="ulist"><ul><li><p>From the Pipelines tab, click <strong>Configure</strong> to modify an existing pipeline.</p></li><li><p>Click <strong>Pipeline actions</strong> in the upper right corner, and select <strong>Delete</strong>.</p></li></ul></div>
<div class="imageblock" style=""><img src="https://www.spinnaker.io/guides/user/pipeline/managing-pipelines/images/pipeline-actions.png" alt="pipeline actions"></div></div></section><section id="_editing_as_json"><h2>Editing as JSON</h2><div class="slide-content"><div class="imageblock" style=""><img src="https://www.spinnaker.io/guides/user/pipeline/managing-pipelines/images/pipeline-actions.png" alt="pipeline actions"></div></div></section><section id="_editing_as_json_process"><h2>Editing as JSON Process</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can also edit your pipeline in JSON</p></li><li><p>This is fraught with danger if you get it wrong</p></li><li><p>It can be helpful if things go wrong already</p><div class="ulist"><ul><li><p>Perhaps the UI is not updating the backend correctly</p></li><li><p>You wish to diagnose issues</p></li></ul></div></li><li><p>When you use the <strong>Edit as JSON</strong> feature, you are directly editing the payload.</p></li><li><p>Edit as JSON allows you to set pipeline fields or properties not exposed by the UI.</p></li></ul></div></div></section><section id="_revision_history"><h2>Revision History</h2><div class="slide-content"><div class="ulist"><ul><li><p>Each time you save your pipeline, the current version is added to revision history</p></li><li><p>You can use revision history to diff two versions of a pipeline or to restore an older version of a pipeline.</p><div class="olist arabic"><ol class="arabic"><li><p>From the <strong>Pipelines</strong> tab, click <strong>Configure</strong> to modify an existing pipeline</p></li><li><p>Click <strong>Pipeline Actions</strong> in the upper right corner, and select <strong>View revision history</strong></p></li></ol></div></li></ul></div>
<div class="imageblock" style=""><img src="https://www.spinnaker.io/guides/user/pipeline/managing-pipelines/images/pipeline-actions.png" alt="pipeline actions"></div></div></section><section id="_changing_versions"><h2>Changing Versions</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can compare any version of your pipeline to either the version before it or the current pipeline.</p><div class="olist arabic"><ol class="arabic"><li><p>View the version history</p></li><li><p>Select a version from the Revision drop-down.</p></li></ol></div></li></ul></div>
<div class="imageblock" style=""><img src="https://www.spinnaker.io/guides/user/pipeline/managing-pipelines/images/revision-history.png" alt="revision history"></div></div></section><section id="_comparing_version"><h2>Comparing Version</h2><div class="slide-content"><div class="paragraph"><p>You can also compare a review to either the current revision or the previous one</p></div>
<div class="imageblock" style=""><img src="https://www.spinnaker.io/guides/user/pipeline/managing-pipelines/images/compare-version.png" alt="compare version"></div></div></section><section id="_reverting_your_pipeline"><h2>Reverting your Pipeline</h2><div class="slide-content"><div class="paragraph"><p>If you select a different version, you can revert to that same version</p></div>
<div class="imageblock" style=""><img src="https://www.spinnaker.io/guides/user/pipeline/managing-pipelines/images/restore-revision.png" alt="restore revision"></div></div></section><section id="_rename_a_pipeline"><h2>Rename a Pipeline</h2><div class="slide-content"><div class="olist arabic"><ol class="arabic"><li><p>From the <strong>Pipelines</strong> tab, click <strong>Configure</strong> to modify an existing pipeline.</p></li><li><p>Click <strong>Pipeline actions</strong> in the upper right corner, and select <strong>Rename</strong></p></li></ol></div>
<div class="imageblock" style=""><img src="https://www.spinnaker.io/guides/user/pipeline/managing-pipelines/images/pipeline-actions.png" alt="pipeline actions"></div></div></section></section>
<section><section id="_artifacts"><h2>Artifacts</h2></section><section id="_artifacts_in_spinnaker"><h2>Artifacts in Spinnaker</h2><div class="slide-content"><div class="ulist"><ul><li><p>Named JSON object that refers to an external resource</p><div class="ulist"><ul><li><p>A Docker image</p></li><li><p>A file stored in GitHub</p></li><li><p>An Amazon Machine Image (AMI)</p></li><li><p>A binary blob in Amazon S3, Google Cloud Storage, etc.</p></li></ul></div></li></ul></div>
<div class="imageblock" style=""><img src="./images/artifact_defined.png" alt="artifact defined" width="50%" height="50%"></div></div></section><section id="_artifact_frustration"><h2>Artifact Frustration</h2><div class="slide-content"><div class="paragraph"><p>Artifacts are one of the most frustrating aspects to Spinnaker</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-sh" data-lang="sh">Failed on startup: Unmatched expected artifact ExpectedArtifact(matchArtifact=Artifact(type=s3/object, customKind=false, name=s3://XXXXXXXXXXX-alpha.191%2B926bb3b3.tgz, version=null, location=null, reference=null, metadata={id=01317db7-1e30-4c02-a302-826449d83f94}, artifactAccount=f5cs-spin, provenance=null, uuid=null), usePriorArtifact=false, useDefaultArtifact=false, defaultArtifact=Artifact(type=null, customKind=true, name=null, version=null, location=null, reference=null, metadata={id=ca86ca54-6719-471e-b10e-fb4a6f20e85d}, artifactAccount=null, provenance=null, uuid=null), id=0730e728-e19a-43af-b9e5-9856332e939d, boundArtifact=null) could not be resolved.</code></pre></div></div></div></section><section id="_what_is_the_address_of_our_artifacts"><h2>What is the "address" of our Artifacts?</h2><div class="slide-content"><div class="ulist"><ul><li><p>URI of the location of our artifact</p></li><li><p>Provenance information about the commit that triggered the resource</p></li></ul></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">Provenance <em>def:</em> - The place of origin or earliest known history of something</td></tr></table></div></div></section><section id="_artifact_decoration"><h2>Artifact Decoration</h2><div class="slide-content"><div class="ulist"><ul><li><p>To allow more provenance information, a JSON is used to describe extras like:</p><div class="ulist"><ul><li><p>name</p></li><li><p>version</p></li><li><p>location</p></li></ul></div></li><li><p>This is called <em>artifact decoration</em></p></li><li><p>Every Spinnaker artifact follows this specification whether:</p><div class="ulist"><ul><li><p>Supplied to a pipeline</p></li><li><p>Accessed within a pipeline</p></li><li><p>Produced by a pipeline–follows</p></li></ul></div></li></ul></div></div></section><section id="_artifact_format"><h2>Artifact Format</h2><div class="slide-content"><div class="paragraph"><p>As an example, an object stored in Google Cloud Storage (GCS) might be accessed using the following Spinnaker artifact:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-json" data-lang="json">{
  "type": "gcs/object",
  "reference": "gs://bucket/file.json#135028134000",
  "name": "gs://bucket/file.json",
  "version": "135028134000"
  "location": "us-central1"
}</code></pre></div></div>
<div class="paragraph"><p>Another example</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-json" data-lang="json">{
  "type": "docker/image",
  "reference": "gcr.io/project/image@sha256:29fee8e284",
  "name": "gcr.io/project/image",
  "version": "sha256:29fee8e284"
}</code></pre></div></div></div></section><section id="_spinnaker_artifact_fields"><h2>Spinnaker Artifact Fields</h2><div class="slide-content"><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:25%"><col style="width:50%"><col style="width:25%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Field</th><th class="tableblock halign-left valign-top">Explanation</th><th class="tableblock halign-left valign-top">Notes</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>type</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">How the external resource is classified. (This allows for easy distinction between Docker images and Debian packages, for example).</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>reference</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The URI used to fetch the resource.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>artifactAccount</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The Spinnaker artifact account that has permission to fetch the resource.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>version</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The version of the resource. (By convention, version should only be compared between artifacts of the same type and name.)</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Optional.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>provenance</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The relevant URI from the system that produced the resource. (This is used for deep-linking into other systems from Spinnaker.)</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Optional.</p></td></tr></table></div></section><section id="_spinnaker_artifact_fields_continued"><h2>Spinnaker Artifact Fields Continued</h2><div class="slide-content"><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:25%"><col style="width:50%"><col style="width:25%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">metadata</th><th class="tableblock halign-left valign-top">Arbitrary key / value metadata pertaining to the resource. (This can be useful for scripting within pipeline stages.)</th><th class="tableblock halign-left valign-top">Optional.</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>location</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The region, zone, or namespace of the resource. (This does not add information to the URI, but makes multi-regional deployments easier to configure.)</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Optional.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>uuid</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Used for tracing the artifact within Spinnaker.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Assigned by Spinnaker.</p></td></tr></table></div></section><section id="_expected_artifacts"><h2>Expected Artifacts</h2><div class="slide-content"><div class="ulist"><ul><li><p>Expects a particular artifact to be available</p></li><li><p>Declarable within a pipeline trigger or stage</p></li><li><p>Spinnaker compares an incoming artifact (for example, a manifest file stored in GitHub) to the expected artifact (for example, a manifest with the file path <code>path/to/my/manifest.yml</code>)</p></li><li><p>If there is a match it is <em>bound</em> to that artifact and used</p></li></ul></div></div></section><section id="_expected_and_bound_artifact"><h2>Expected and Bound Artifact</h2><div class="slide-content"><div class="imageblock" style=""><img src="./images/expected_artifact_github.png" alt="expected artifact github"></div></div></section><section id="_matched_artifacts"><h2>Matched Artifacts</h2><div class="slide-content"><div class="ulist"><ul><li><p>Used to disambiguate between similar artifacts coming from the same account</p><div class="ulist"><ul><li><p>e.g. Different <code>yaml</code> files from the same repository</p></li></ul></div></li><li><p>Filter by fields in the artifact format against which to compare in the incoming artifact</p></li><li><p>Used to specify that the trigger should begin pipeline execution only if the incoming artifact matches the parameters that you provided</p></li></ul></div></div></section><section id="_prior_execution_and_default_artifacts"><h2>Prior execution and Default Artifacts</h2><div class="slide-content"><div class="imageblock" style=""><img src="./images/default_artifact.png" alt="default artifact"></div></div></section><section id="_prior_execution_and_default_artifacts_fields"><h2>Prior execution and Default Artifacts Fields</h2><div class="slide-content"><div class="ulist"><ul><li><p><strong>If Missing</strong></p><div class="ulist"><ul><li><p>Provide fallback behavior for the expected artifact in case the trigger doesn&#8217;t find the desired artifact.</p></li></ul></div></li><li><p><strong> Use prior execution</strong></p><div class="ulist"><ul><li><p>Spinnaker will fall back to the artifact used in the last execution.</p></li><li><p>If you enable the <strong>Use default artifact</strong> Spinnaker will use a default artifact,</p></li><li><p>Allows you to provide fallback behavior for the first time a trigger is used, when no previous execution exists</p></li></ul></div></li></ul></div></div></section><section id="_review_of_artifacts"><h2>Review of Artifacts</h2><div class="slide-content"><div class="ulist"><ul><li><p>Expected - An artifact that a trigger or stage expects to have</p></li><li><p>Bound - An artifact that has been fulfilled</p></li><li><p>Matched - Enter fields to disambiguate similar artifacts</p></li></ul></div></div></section><section id="_artifacts_in_pipelines_defined"><h2>Artifacts in Pipelines Defined</h2><div class="slide-content"><div class="ulist"><ul><li><p>An artifact arrives in a pipeline execution either from an external trigger (for example, a Docker image pushed to a registry)</p></li><li><p>Getting fetched by a stage. That artifact is then consumed by downstream stages based on predefined behavior.</p></li></ul></div></div></section><section id="_expected_artifacts_2"><h2>Expected Artifacts</h2><div class="slide-content"><div class="ulist"><ul><li><p>Enable a stage to bind an artifact from:</p><div class="ulist"><ul><li><p>Another pipeline execution</p></li><li><p>Stage output</p></li><li><p>Running environment</p></li></ul></div></li></ul></div></div></section><section id="_triggers"><h2>Triggers</h2><div class="slide-content"><div class="paragraph"><p>When configuring a pipeline trigger, you can declare which artifacts the trigger expects to have present before it begins a pipeline execution!</p></div>
<div class="imageblock" style=""><img src="./images/triggers.png" alt="triggers"></div></div></section><section id="_find_artifact_from_execution"><h2>Find Artifact from Execution</h2><div class="slide-content"><div class="ulist"><ul><li><p>To allow you to promote artifacts between executions, you can make use of the “Find Artifact from Execution” stage.</p></li><li><p>All that’s required is the pipeline ID whose execution history to search, and an expected artifact to bind.</p></li><li><p>This will be particularly useful for canary attainment of baseline</p></li></ul></div>
<div class="imageblock" style=""><img src="https://www.spinnaker.io/reference/artifacts/in-pipelines/find-artifact-from-execution.png" alt="find artifact from execution"></div></div></section><section id="_artifacts_passed_between_pipelines"><h2>Artifacts Passed between Pipelines</h2><div class="slide-content"><div class="ulist"><ul><li><p>Artifacts can be passed between pipelines.</p></li><li><p>Two cases:</p><div class="ulist"><ul><li><p>Pipeline B is triggered by Pipeline A - Pipeline B is triggered by Pipeline A, therefore Pipeline B will have Pipeline A&#8217;s artifacts</p></li><li><p>Pipeline A triggers Pipeline B - Pipeline A is triggers Pipeline B, therefore Pipeline B will have Pipeline A&#8217;s artifacts</p></li></ul></div></li></ul></div></div></section><section id="_stages_that_produce_artifacts"><h2>Stages that Produce Artifacts</h2><div class="slide-content"><div class="paragraph"><p>Stages can be configured to ‘Produce’ artifacts if they expose the following Stage configuration:</p></div>
<div class="imageblock" style=""><img src="https://www.spinnaker.io/reference/artifacts/in-pipelines/produced-artifact.png" alt="produced artifact"></div></div></section><section id="_ways_to_produce_artifacts"><h2>Ways to Produce Artifacts</h2><div class="slide-content"><div class="olist arabic"><ol class="arabic"><li><p>To bind artifacts injected into the stage context - If your stage emits artifacts (such as a “Deploy (Manifest)” stage) into the pipeline context, you can match against these artifacts for downstream stages to consume.</p></li><li><p>To artificially inject artifacts into the stage context - If you are running a stage that does not natively emit artifacts (such as the “Run Job” stage), you can use the default artifact, which always binds to the expected artifact, to be injected into the pipeline each time it is run. Keep in mind: If the matching artifact is empty, it will bind any artifact, and your default artifact will not be used.</p></li></ol></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">If you are configuring your stages using JSON, the expected artifacts are placed in a top-level <code>expectedArtifacts: []</code> list.</td></tr></table></div></div></section><section id="_various_types_of_artifacts"><h2>Various Types of Artifacts</h2><div class="slide-content"><div class="paragraph"><p>There are various types of artifacts or you can define your own:</p></div>
<div class="ulist"><ul><li><p>Docker Image</p></li><li><p>Embedded Base64</p></li><li><p>GCS Object</p></li><li><p>S3 Object</p></li><li><p>Git Repo</p></li><li><p>GitHub File</p></li><li><p>GitLab File</p></li><li><p>Bitbucket File</p></li><li><p>HTTP File</p></li><li><p>Kubernetes Object</p></li><li><p>Oracle Object</p></li></ul></div>
<div class="paragraph"><p>Source: <a href="https://www.spinnaker.io/reference/artifacts/types/overview" class="bare">https://www.spinnaker.io/reference/artifacts/types/overview</a></p></div></div></section><section id="_sources"><h2>Sources</h2><div class="slide-content"><div class="paragraph"><p><a href="https://www.spinnaker.io/reference/artifacts-with-artifactsrewrite/" class="bare">https://www.spinnaker.io/reference/artifacts-with-artifactsrewrite/</a>
<a href="https://www.spinnaker.io/reference/artifacts-with-artifactsrewrite/in-kubernetes-v2/" class="bare">https://www.spinnaker.io/reference/artifacts-with-artifactsrewrite/in-kubernetes-v2/</a></p></div></div></section></section>
<section><section id="_linking_spinnaker_to_github"><h2>Linking Spinnaker to Github</h2></section><section id="_overview_3"><h2>Overview</h2><div class="slide-content"><div class="ulist"><ul><li><p>In order to connect to github, we will need to establish a token</p></li><li><p>This will build a connection from Spinnaker to Github</p></li><li><p>As users you will create the token</p></li><li><p>As administration you will put the token in Spinnaker using Halyard</p></li></ul></div></div></section><section id="_creating_a_token"><h2>Creating a token</h2><div class="slide-content"><div class="ulist"><ul><li><p>Visit your github account at: <a href="https://github.com/settings/tokens" class="bare">https://github.com/settings/tokens</a></p></li><li><p>Click on the <strong>Generate new token</strong> button</p></li></ul></div>
<div class="imageblock" style=""><img src="./images/github-token.png" alt="github token"></div><div class="title">Figure 3. Token Page</div></div></section><section id="_select_the_public_repo_scope"><h2>Select the <code>public_repo</code> scope</h2><div class="slide-content"><div class="paragraph"><p>Select the <code>public repo</code> scope</p></div>
<div class="imageblock" style=""><img src="./images/github_access.png" alt="github access"></div><div class="title">Figure 4. Allowing Use</div></div></section><section id="_copying_the_token"><h2>Copying the token</h2><div class="slide-content"><div class="ulist"><ul><li><p>You have one shot to copy the token and secure it</p></li><li><p>Copy it, by clicking on the clipboard icon next to the hash</p></li></ul></div>
<div class="imageblock" style=""><img src="./images/github_hash.png" alt="github hash"></div></div></section><section id="_setting_up_the_token_in_spinnaker"><h2>Setting up the token in Spinnaker</h2><div class="slide-content"><div class="paragraph"><p>Paste the token and store it in a temporary file</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-sh" data-lang="sh">pbpaste &gt; token_file.txt</code></pre></div></div>
<div class="paragraph"><p>Setup some temporary fields for both the location of token file, and the github account name</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-sh" data-lang="sh">TOKEN_FILE=~/token_file.txt
ARTIFACT_ACCOUNT_NAME=&lt;github-username&gt;-account</code></pre></div></div></div></section><section id="_installing_your_github_connection"><h2>Installing your Github connection</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-sh" data-lang="sh">hal config features edit --artifacts true
hal config artifact github enable</code></pre></div></div>
<div class="paragraph"><p>Add your account:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-sh" data-lang="sh">hal config artifact github account add $ARTIFACT_ACCOUNT_NAME \
    --token-file $TOKEN_FILE</code></pre></div></div></div></section><section id="_deploy_to_spinnaker"><h2>Deploy to Spinnaker</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-sh" data-lang="sh">hal deploy apply</code></pre></div></div></div></section></section>
<section id="_lab_1_deploying_eks_microservices"><h2>Lab 1: Deploying EKS Microservices</h2></section>
<section><section id="_expressions"><h2>Expressions</h2></section><section id="_expressions_defined"><h2>Expressions Defined</h2><div class="slide-content"><div class="ulist"><ul><li><p>Dynamically set and access variables during pipeline execution</p></li><li><p>Any text field can use an expression</p></li><li><p>Use them to:</p><div class="ulist"><ul><li><p>Use arbitrary values about the state of your system in the execution of your pipelines.</p></li><li><p>Turn on or off particular stages or branches of your pipeline</p></li><li><p>Dynamically name your stack</p></li><li><p>Check the status of another stage</p></li><li><p>Perform other operations.</p></li></ul></div></li></ul></div></div></section><section id="_what_are_expressions"><h2>What are expressions?</h2><div class="slide-content"><div class="paragraph"><p>A pipeline expression is made up of $ followed by opening/closing brackets: <code>${ }</code></p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-sh" data-lang="sh">${expression here}</code></pre></div></div></div></section><section id="_string_interpolation"><h2>String interpolation</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-sh" data-lang="sh"> ${expressionA}-randomString-${expressionB}</code></pre></div></div>
<div class="paragraph"><p>Given "Hello" for <code>expressionA</code> and <code>world</code> for <code>expressionB</code>, this will result in:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-sh" data-lang="sh">Hello-randomString-world.</code></pre></div></div></div></section><section id="_where_can_expressions_be_used"><h2>Where can Expressions be used?</h2><div class="slide-content"><div class="ulist"><ul><li><p>Pipeline expressions any place in the UI where you can enter free-form text</p></li><li><p>Exception of the pipeline <strong>Configuration</strong> stage with exception of Expected Artifacts and "Use Default Artifact"</p></li><li><p>If text field is unavailable, there is a feature called <strong>Edit as JSON</strong></p></li></ul></div></div></section><section id="_when_are_they_evaluated"><h2>When are they evaluated</h2><div class="slide-content"><div class="ulist"><ul><li><p>Expressions are evaluated at the beginning of that stage</p></li><li><p><strong>Configuration</strong> needs to be evaluated <em>before</em> expression</p></li></ul></div></div></section><section id="_helper_functions"><h2>Helper Functions</h2><div class="slide-content"><div class="ulist"><ul><li><p>Helper functions simplify common use cases</p><div class="ulist"><ul><li><p>Access a particular stage by name</p></li><li><p>Strip non-alphanumerical characters</p></li><li><p>Parse JSON</p></li></ul></div></li></ul></div></div></section><section id="_finding_helper_functions"><h2>Finding Helper Functions</h2><div class="slide-content"><div class="paragraph"><p>Adding a pound sign (<code>#</code>) within your pipeline expression displays a list of all the helper functions that are available</p></div>
<div class="imageblock" style=""><img src="https://www.spinnaker.io/guides/user/pipeline/expressions/images/helper-func-autocomplete.png" alt="helper func autocomplete"></div></div></section><section id="_helper_properties"><h2>Helper Properties</h2><div class="slide-content"><div class="paragraph"><p>Helper properties are variables which refer to global information about the current pipeline execution.</p></div>
<div class="ulist"><ul><li><p><code>execution</code> - refers to the current pipeline execution</p></li><li><p><code>trigger</code> - information about the pipeline trigger</p><div class="ulist"><ul><li><p>e.g. Jenkins trigger and want to know which build triggered the current pipeline</p></li><li><p><code>${trigger["buildInfo"]["number"]}</code></p></li></ul></div></li></ul></div></div></section><section id="_getting_help_with_helper_properties"><h2>Getting Help with Helper Properties</h2><div class="slide-content"><div class="ulist"><ul><li><p>List available helper properties and stages enter a question mark (<code>?</code>) into your pipeline expression</p></li><li><p>Type a little more of what you are looking for to narrow down your choices</p></li></ul></div>
<div class="admonitionblock important"><table><tr><td class="icon"><i class="fa fa-exclamation-circle" title="Important"></i></td><td class="content">Once a helper property is added to the expression you can use any of the meta keys (Shift, Command, Alt, Control) to bring up a list of all the pipeline context that is relevant to the selected helper property.</td></tr></table></div>
<div class="imageblock" style=""><img src="https://www.spinnaker.io/guides/user/pipeline/expressions/images/helper-properties-list.png" alt="helper properties list"></div></div></section><section id="_context_values"><h2>Context Values</h2><div class="slide-content"><div class="ulist"><ul><li><p><em>Context Values</em> are specific to a stage.</p></li><li><p>Includes:</p><div class="ulist"><ul><li><p>Stage Name</p></li><li><p>Status</p></li><li><p>Start and End Time</p></li></ul></div></li></ul></div></div></section><section id="_finding_context_values"><h2>Finding Context Values</h2><div class="slide-content"><div class="imageblock" style=""><img src="https://www.spinnaker.io/guides/user/pipeline/expressions/images/execution-json.png" alt="execution json" width="75%" height="75%"></div><div class="title">Figure 5. Click on the source link under the pipeline execution, which opens a new tab containing the JSON details of your pipeline execution.</div></div></section><section id="_testing_pipeline_executions"><h2>Testing Pipeline Executions</h2><div class="slide-content"><div class="ulist"><ul><li><p>Testing is done through the API</p></li><li><p>You need a running instance of Spinnaker</p></li><li><p>Use <strong>Source</strong> of any stage and identify the pipeline execution</p></li></ul></div>
<div class="imageblock" style=""><img src="https://www.spinnaker.io/guides/user/pipeline/expressions/images/execution-json.png" alt="execution json" width="55%" height="55%"></div></div></section><section id="_using_curl"><h2>Using <code>curl</code></h2><div class="slide-content"><div class="paragraph"><p>You can then use <code>curl</code> to test your expression</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-sh" data-lang="sh">PIPELINE_ID=[your_pipeline_id]
curl http://api.my.spinnaker/pipelines/$PIPELINE_ID/evaluateExpression \
       -H "Content-Type: text/plain" \
       --data '${ #stage("Deploy").status.toString() }'</code></pre></div></div>
<div class="paragraph"><p>This then returns if successful</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-sh" data-lang="sh">{"result": "SUCCEEDED"}</code></pre></div></div></div></section><section id="_pipeline_unsucessful"><h2>Pipeline Unsucessful</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-sh" data-lang="sh">{
  "detail":
    {
      "{ #stage(\"Deploy\").status.toString() ":
        [
          {
            "description":
              "Failed to evaluate [expression] Expression
              [{ #stage( #root.execution, \"Deploy\").status.toString() ]
              @0: No ending suffix '}' for expression starting at character 0:
              { #stage( #root.execution, \"Deploy\").status.toString() ",
            "exceptionType":"org.springframework.expression.ParseException",
            "level":"ERROR",
            "timestamp":1531254890849
         }
        ]
   },
  "result":"${#stage(\"Deploy\").status.toString() "
}</code></pre></div></div></div></section></section>
<section id="_lab_2_using_expressions"><h2>Lab 2: Using Expressions</h2></section>
<section><section id="_baking"><h2>Baking</h2><div class="slide-content"><div class="paragraph"><p>Baking turns templates into manifests with the help of a templating engine.
Helm relies on the <code>helm template</code> command.</p></div></div></section><section id="_reminder_on_helm_templates"><h2>Reminder on Helm Templates</h2><div class="slide-content"><div class="paragraph"><p>We can take any <code>yaml</code> resource meant for Kubernetes</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: mychart-configmap
data:
  myvalue: "Hello World"</code></pre></div></div></div></section><section id="_templatize_helm_templates"><h2>Templatize Helm Templates:</h2><div class="slide-content"><div class="paragraph"><p>We can then templatize it with a release, called <em>release name</em></p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-configmap
data:
  myvalue: "Hello World"</code></pre></div></div>
<div class="paragraph"><p><code>{{ .Release.Name }}</code> will be replaced by the name of the release when the end user runs</p></div></div></section><section id="_debugging_our_chart"><h2>Debugging our Chart</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-sh" data-lang="sh">helm install --debug --dry-run goodly-guppy ./mychart</code></pre></div></div></div></section><section id="_result_chart"><h2>Result Chart</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-sh" data-lang="sh">apiVersion: v1
kind: ConfigMap
metadata:
  name: goodly-guppy-configmap
data:
  myvalue: "Hello World"</code></pre></div></div></div></section><section id="_helm_charts_offers_a_lot"><h2>Helm Charts offers a lot</h2><div class="slide-content"><div class="ulist"><ul><li><p>Values</p></li><li><p>Defaults</p></li><li><p>Template Functions and Pipelines</p></li><li><p>Flow Control</p></li><li><p>Variables</p></li><li><p>Embedded Templates</p></li></ul></div>
<div class="paragraph"><p>Read more: <a href="https://helm.sh/docs/chart_template_guide/getting_started/" class="bare">https://helm.sh/docs/chart_template_guide/getting_started/</a></p></div></div></section><section id="_intentions"><h2>Intentions</h2><div class="slide-content"><div class="paragraph"><p>This stage is intended to help you package and deploy applications that you own,
and are actively developing and redeploying frequently. It is not intended to
serve as a one-time installation method for third-party packages. If that
is your goal, it’s arguably better to call helm install once when
bootstrapping your Kubernetes cluster.</p></div></div></section><section id="_configure_artifact_support_in_hal"><h2>Configure Artifact support in Hal</h2><div class="slide-content"><div class="ulist"><ul><li><p>Make sure that you have configured artifact support in Spinnaker first in Halyard</p></li><li><p>All Helm charts are fetched/stored as artifacts in Spinnaker</p></li></ul></div></div></section><section id="_create_a_bake_manifest_stage"><h2>Create a Bake Manifest Stage</h2><div class="slide-content"><div class="ulist"><ul><li><p>Create a "Bake (Manifest)" stage</p></li></ul></div>
<div class="imageblock" style=""><img src="./images/bake_manifest.png" alt="bake manifest" width="30%" height="30%"></div></div></section><section id="_configure_the_bake_manifest_stage"><h2>Configure the Bake Manifest Stage</h2><div class="slide-content"><div class="imageblock" style=""><img src="./images/bake_manifest_config_1.png" alt="bake manifest config 1" width="80%" height="80%"></div>
<div class="imageblock" style=""><img src="./images/bake_manifest_config_2.png" alt="bake manifest config 2" width="80%" height="80%"></div></div></section><section id="_configure_the_bake_manifest_stage_detail"><h2>Configure the Bake Manifest Stage Detail</h2><div class="slide-content"><div class="ulist"><ul><li><p>Enter the release name (required) - The Helm release name for this chart. This determines the name of the artifact produced by this stage</p></li><li><p>The template artifact (required) - The Helm chart that you will be deploying, stored remotely as a <code>.tar.gz</code> archive</p></li><li><p>The release namespace - The Kubernetes namespace to install release into. If parameter is not specified default namespace will be used</p></li><li><p>Zero or more override artifacts (optional) - The files passed to <code>--values</code> parameter in the helm template command. Each is a remotely stored artifact representing a Helm Value File.</p></li><li><p>Statically specified overrides - The set of static of <code>key/value</code> pairs that are passed as <code>--set</code> parameters to the <code>helm template</code> command.</p></li></ul></div></div></section><section id="_helm_charts_and_namespace"><h2>Helm Charts and Namespace</h2><div class="slide-content"><div class="paragraph"><p>Make sure you have <code>namespace</code> declaration in your helm chart if you are overriding the <code>namespace</code></p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-yaml" data-lang="yaml">metadata:
  namespace: {{ .Release.Namespace }}</code></pre></div></div></div></section><section id="_producing_baked_artifacts"><h2>Producing Baked Artifacts</h2><div class="slide-content"><div class="paragraph"><p>In the “Produces Artifacts” section:</p></div>
<div class="ulist"><ul><li><p>Spinnaker has automatically created an <code>embedded/base64</code> artifact</p></li><li><p>The artifact is bound when the stage completes</p></li><li><p>Represents the fully baked manifest set to be deployed downstream</p></li></ul></div>
<div class="imageblock" style=""><img src="https://www.spinnaker.io/guides/user/kubernetes-v2/deploy-helm/produces.png" alt="produces"></div></div></section><section id="_configure_downstream_deployment"><h2>Configure Downstream Deployment</h2><div class="slide-content"><div class="paragraph"><p>Now that the manifest set has been baked by Helm</p></div>
<div class="ulist"><ul><li><p>Configure a downstream stage (in the same pipeline or in one triggered by this pipeline)</p></li><li><p>Deploy the artifact produced by the “Bake (Manifest)” stage</p></li></ul></div>
<div class="imageblock" style=""><img src="https://www.spinnaker.io/guides/user/kubernetes-v2/deploy-helm/expected-artifact.png" alt="expected artifact"></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">Note: Make sure to select "embedded-artifact" as the artifact account for your <code>base64</code> manifest set.
This is required to translate the manifest set into the format required by the deploy stage.</td></tr></table></div></div></section></section>
<section id="_lab_3_deploying_helm_microservices"><h2>Lab 3: Deploying Helm Microservices</h2></section>
<section><section id="_rollbacks"><h2>Rollbacks</h2></section><section id="_automatic_rollbacks"><h2>Automatic Rollbacks</h2><div class="slide-content"><div class="ulist"><ul><li><p>Having manifests is optimal, IaC</p></li><li><p>Rollbacks though are necessary when things go wrong</p></li></ul></div></div></section><section id="_viewing_the_rollbacks"><h2>Viewing the Rollbacks</h2><div class="slide-content"><div class="ulist"><ul><li><p>When using a Kubernetes <code>Deployment</code>, history of rollouts is in the <code>Clusters</code> tab of your Application</p></li><li><p>Spinnaker exposes “Undo Rollout” functionality in two places:</p><div class="ulist"><ul><li><p>Clusters tab</p></li><li><p>Pipeline stage</p></li></ul></div></li></ul></div>
<div class="imageblock" style=""><img src="https://www.spinnaker.io/guides/user/kubernetes-v2/automated-rollbacks/revisions.png" alt="revisions"></div></div></section><section id="_ad_hoc_rollbacks"><h2>Ad Hoc Rollbacks</h2><div class="slide-content"><div class="ulist"><ul><li><p>In cases where you see something is immediately wrong and isolated to a resource in the “Clusters” tab</p></li><li><p>You can select “Undo Rollout” from the “Actions” dropdown</p></li><li><p>This provides an opportunity to select a healthier alternative</p></li></ul></div>
<div class="imageblock" style=""><img src="https://www.spinnaker.io/guides/user/kubernetes-v2/automated-rollbacks/adhoc.png" alt="adhoc"></div></div></section><section id="_automated_rollbacks"><h2>Automated Rollbacks</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can also configure automated rollbacks inside of Spinnaker pipelines.</p></li><li><p>These stages are best configured to run when other stages or branches fail, indicating that something has gone wrong in your rollout.</p></li><li><p>Number of Revisions Back:</p><div class="ulist"><ul><li><p>Counts how many revisions the current active revision should be rolled back by. If you have the following state:</p></li></ul></div></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code>nginx-deployment-2d8178b77 (Revision 5) # active
nginx-deployment-7bdd110f7 (Revision 4)
nginx-deployment-0b13cc8c1 (Revision 1)</code></pre></div></div>
<div class="paragraph"><p>And roll back by <code>“1”</code> revision, <code>(Revision 4)</code> will be active again. Roll back by <code>“2”</code> revisions and <code>(Revision 1)</code> will be active again.</p></div>
<div class="paragraph"><p>Keep in mind that Kubernetes will implicitly roll-forward the old configuration, creating <code>(Revision 6)</code> in both cases.</p></div></div></section><section id="_parameterized_rollbacks"><h2>Parameterized Rollbacks</h2><div class="slide-content"><div class="ulist"><ul><li><p>Parameterize the target resource to roll back</p></li><li><p>Reference anything via pipeline expressions</p></li><li><p>Point to something specified using pipeline parameters, for example:</p><div class="ulist"><ul><li><p>Upstream deploy stage</p></li><li><p>Another stage’s outputs</p></li><li><p>Using pipeline expressions.</p></li></ul></div></li></ul></div></div></section><section id="_versioning_artifacts"><h2>Versioning Artifacts</h2><div class="slide-content"><div class="ulist"><ul><li><p>Rolling Back will not work unless artifacts are versioned, this includes:</p><div class="ulist"><ul><li><p>Docker images</p></li><li><p><code>ConfigMap</code></p></li><li><p>Kubernetes Secrets</p></li></ul></div></li></ul></div>
<div class="paragraph"><p>Source: <a href="https://blog.questionable.services/article/kubernetes-deployments-configmap-change/" class="bare">https://blog.questionable.services/article/kubernetes-deployments-configmap-change/</a></p></div></div></section></section>
<section><section id="_scaling"><h2>Scaling</h2></section><section id="_scaling_resources"><h2>Scaling Resources</h2><div class="slide-content"><div class="paragraph"><p>From the <strong>Clusters</strong> Page and selecting the Deployment you can scale the Replica Sets supports</p></div>
<div class="imageblock" style=""><img src="./images/scaling.png" alt="scaling" width="20%" height="20%"></div></div></section><section id="_select_the_replicas"><h2>Select the Replicas</h2><div class="slide-content"><div class="paragraph"><p>You can then select the number of replicas you wish to either increase or decrease</p></div>
<div class="imageblock" style=""><img src="./images/scaling_confirmation.png" alt="scaling confirmation" width="50%" height="50%"></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">If you want the number of replica sets permanent, be sure to update your yaml file, changes will not be persisted</td></tr></table></div>
<div style="page-break-after: always;"></div></div></section></section>
<section><section id="_rollout_stratagies"><h2>Rollout Stratagies</h2><div class="slide-content"><div class="ulist"><ul><li><p>Deploys your containers as either:</p><div class="ulist"><ul><li><p>Dark Rollouts</p></li><li><p>Highlander</p></li><li><p>Red/Black (also known as Blue/Green)</p></li></ul></div></li><li><p>Is only valid for Kubernetes <code>ReplicaSet</code></p></li><li><p>Verifies health checks</p></li><li><p>Disables old server groups</p></li><li><p>Enabling new server groups</p></li></ul></div></div></section><section id="_configuration_options"><h2>Configuration Options</h2><div class="slide-content"><div class="ulist"><ul><li><p>Configuration options allow you to associate a workload with one or more services</p></li><li><p>Decide whether the workload should receive traffic, and determine how Spinnaker should handle any previous versions of the workload in the same cluster and <code>namespace</code></p></li></ul></div>
<div class="imageblock" style=""><img src="./images/deployment_strategy.png" alt="deployment strategy"></div></div></section><section id="_configuration_details"><h2>Configuration Details</h2><div class="slide-content"><div class="ulist"><ul><li><p>Service namespace - Select the namespace containing the service(s) you would like to associate with the workload.</p></li><li><p>Service(s) - Select one or more services you would like to associate with the workload. Spinnaker will add a traffic.spinnaker.io/load-balancers annotation listing the selected services as described here.</p></li><li><p>Traffic - Check this box if you would like the workload to begin receiving traffic from the selected services as soon as it is ready. If you do not check this box, you can add a subsequent Enable (Manifest) stage to begin sending traffic to the workload.</p></li><li><p>Strategy - Select a strategy if you would like Spinnaker to handle previous versions of the workload currently deployed to the same cluster and namespace. Select None if you do not want Spinnaker to take any action regarding existing workloads.</p></li></ul></div></div></section><section id="_strategies"><h2>Strategies</h2></section><section id="_dark_rollouts"><h2>Dark Rollouts</h2><div class="slide-content"><div class="ulist"><ul><li><p>Use a dark rollout to deploy a new version of your application alongside the existing version(s)</p></li><li><p>Does not immediately route any traffic to the new version.</p></li><li><p>Optionally, add subsequent Enable (Manifest) and Disable (Manifest) stage to begin sending traffic to the new version and stop sending traffic to the old version(s).</p></li></ul></div>
<div class="imageblock" style=""><img src="https://www.spinnaker.io/guides/user/kubernetes-v2/rollout-strategies/dark.png" alt="dark"></div></div></section><section id="_highlander"><h2>Highlander</h2><div class="slide-content"><div class="quoteblock"><blockquote><div class="paragraph"><p>"There can be only one"&#8201;&#8212;&#8201;Highlander (1986)</p></div></blockquote></div>
<div class="ulist"><ul><li><p>Deploy a new version of your application alongside the existing version(s)</p></li><li><p>Send client traffic to the new version</p></li><li><p>Then disable and destroy existing versions in the cluster</p></li></ul></div>
<div class="imageblock" style=""><img src="https://www.spinnaker.io/guides/user/kubernetes-v2/rollout-strategies/highlander.png" alt="highlander"></div></div></section><section id="_redblack_bluegreen"><h2>Red/Black (Blue/Green)</h2><div class="slide-content"><div class="ulist"><ul><li><p>Red/black rollout to deploy a new version of your application alongside the existing version(s)</p></li><li><p>Send client traffic to the new version, and then disable existing versions in the cluster</p></li><li><p>Optionally, add subsequent Destroy (Manifest) stages to clean up any unwanted workloads in the cluster</p></li><li><p>Alternately, easily roll back to a previous version by:</p><div class="ulist"><ul><li><p>Configuring an <strong>Enable (Manifest)</strong> stage</p></li><li><p>Or using an ad-hoc Enable operation from the Clusters tab.</p></li></ul></div></li></ul></div>
<div class="imageblock" style=""><img src="https://www.spinnaker.io/guides/user/kubernetes-v2/rollout-strategies/redblack.png" alt="redblack"></div></div></section></section>
<section><section id="_restrict_execution"><h2>Restrict Execution</h2></section><section id="_execution_windows"><h2>Execution Windows</h2><div class="slide-content"><div class="ulist"><ul><li><p>Execution windows allow you to restrict the times of the day or week when deployments can happen.</p></li><li><p>By using execution windows, you can ensure that deployments don’t interfere with times where your service is at peak demand.</p></li><li><p>You can also use execution windows to make sure that there is always someone in the office ready to manually intervene or rollback your pipeline.</p></li></ul></div>
<div class="imageblock" style=""><img src="./images/execution_window.png" alt="execution window"></div></div></section></section>
<section><section id="_manual_judgment"><h2>Manual Judgment</h2></section><section id="_manual_judgment_defined"><h2>Manual Judgment Defined</h2><div class="slide-content"><div class="paragraph"><p>Manual Judgments serve as a gate for your pipeline
You can add manual judgment stages to interrupt the pipeline execution to run a manual check
This is great for teams that have a manual or out-of-band QA process</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Click on Configuration and select <strong>Add New Stage</strong></p></li><li><p>Enter “Please approve this pipeline” in the instructions</p></li></ol></div>
<div class="imageblock" style=""><img src="https://www.spinnaker.io/guides/tutorials/codelabs/safe-deployments/images/manual1.png" alt="manual1"></div></div></section><section id="_notifications_with_manual_judgment"><h2>Notifications with Manual Judgment</h2><div class="slide-content"><div class="imageblock" style=""><img src="https://www.spinnaker.io/guides/tutorials/codelabs/safe-deployments/images/manual2.png" alt="manual2"></div></div></section><section id="_notifications_with_manual_judgment_2"><h2>Notifications with Manual Judgment</h2><div class="slide-content"><div class="olist arabic"><ol class="arabic"><li><p>Click on <strong>Add Notification Preference</strong></p></li><li><p>In the popup dialog:</p><div class="olist loweralpha"><ol class="loweralpha" type="a"><li><p>Select type Email</p></li><li><p>Enter your email address</p></li><li><p>Select to notify when <strong>This stage is awaiting judgment</strong>.</p></li><li><p>Click <strong>Update</strong></p></li></ol></div></li></ol></div></div></section><section id="_waiting_for_approval"><h2>Waiting for Approval</h2><div class="slide-content"><div class="imageblock" style=""><img src="https://www.spinnaker.io/guides/tutorials/codelabs/safe-deployments/images/manual6.png" alt="manual6"></div></div></section><section id="_changing_pipeline_on_selected_judgment"><h2>Changing Pipeline on Selected Judgment</h2><div class="slide-content"><div class="paragraph"><p>You can enter in your own choices and use SpEL to respond to the answers</p></div>
<div class="imageblock" style=""><img src="https://www.spinnaker.io/guides/tutorials/codelabs/safe-deployments/images/manual7.png" alt="manual7"></div></div></section><section id="_triggering_on_choice"><h2>Triggering on Choice</h2><div class="slide-content"><div class="paragraph"><p>Once applied you can create a subsequent stage that will conditionally trigger on your choice, using Expressions (SpEL)</p></div>
<div class="imageblock" style=""><img src="https://www.spinnaker.io/guides/tutorials/codelabs/safe-deployments/images/manual8.png" alt="manual8"></div></div></section></section>
<section><section id="_canary_deployment"><h2>Canary Deployment</h2></section><section id="_what_is_it"><h2>What is it?</h2><div class="slide-content"><div class="ulist"><ul><li><p>Canary is a deployment process in which a change is partially rolled out then evaluated against the current deployment (baseline)</p></li><li><p>Ensure that the new deployment is operating at least as well as the old.</p></li><li><p>This evaluation is done using key metrics that are chosen when the canary is configured.</p></li><li><p>Microservices would need to expose some of their metrics</p></li><li><p>Canaries are usually run against deployments containing changes to code,
but they can also be used for operational changes, including changes to configuration.</p></li></ul></div></div></section><section id="_prerequisites"><h2>Prerequisites</h2><div class="slide-content"><div class="ulist"><ul><li><p>Have metrics to evaluate</p><div class="ulist"><ul><li><p>Provide metrics in your microservice application</p></li><li><p>Either deploy metrics or have it scraped</p></li><li><p>Support is built in for:</p><div class="ulist"><ul><li><p>StackDriver</p></li><li><p>Datadog</p></li><li><p>Prometheus</p></li><li><p>SignalFx</p></li><li><p>NewRelic</p></li></ul></div></li></ul></div></li></ul></div></div></section><section id="_process"><h2>Process</h2><div class="slide-content"><div class="ulist"><ul><li><p>Enable Canary</p></li><li><p>Create one or more canary configurations</p></li><li><p>Add one or more canary stages</p></li></ul></div></div></section><section id="_enable_canary"><h2>Enable Canary</h2><div class="slide-content"><div class="ulist"><ul><li><p>Use Halyard</p></li><li><p>Setup <em>one</em> Metrics Service</p></li><li><p>Setup <em>one</em> a Storage Service</p></li></ul></div></div></section><section id="_setting_up_canary_analysis"><h2>Setting up Canary Analysis</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-sh" data-lang="sh">hal config canary enable</code></pre></div></div></div></section><section id="_setting_up_the_scope"><h2>Setting up the Scope</h2><div class="slide-content"><div class="ulist"><ul><li><p>Each configuration is visible to all canary pipeline stages</p></li><li><p>It can be configured so that it is only visible to the application where it was created</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-sh" data-lang="sh">hal config canary edit --show-all-configs-enabled false</code></pre></div></div></div></section><section id="_setting_up_the_canary_judge"><h2>Setting up the canary judge</h2><div class="slide-content"><div class="ulist"><ul><li><p>The current default judge is <code>NetflixACAJudge-v1.0</code></p></li><li><p>A judge accesses the quality of your deployment against the baseline</p></li><li><p>Each is compared to determine any degradation</p></li><li><p>Other judges are available and are pluggable</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-sh" data-lang="sh">hal config canary edit --default-judge JUDGE</code></pre></div></div></div></section><section id="_identify_your_metrics_provider"><h2>Identify your metrics provider</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-sh" data-lang="sh">hal config canary edit --default-metrics-store STORE</code></pre></div></div>
<div class="paragraph"><p><code>STORE</code> can be:</p></div>
<div class="ulist"><ul><li><p>atlas</p></li><li><p>datadog</p></li><li><p>stackdriver</p></li><li><p>prometheus</p></li><li><p>newrelic</p></li></ul></div></div></section><section id="_provide_a_default_metrics_account"><h2>Provide a default metrics account</h2><div class="slide-content"><div class="ulist"><ul><li><p>Add the account name to use for your metrics provider</p></li><li><p>Default can be overridden</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-sh" data-lang="sh">hal config canary edit --default-metrics-account ACCOUNT</code></pre></div></div></div></section><section id="_provide_the_default_storage_account"><h2>Provide the default storage account</h2><div class="slide-content"><div class="ulist"><ul><li><p>Add the account name to use for your storage provider</p></li><li><p>Default can be overridden</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-sh" data-lang="sh">hal config canary edit --default-storage-account ACCOUNT</code></pre></div></div></div></section><section id="_setting_up_prometheus"><h2>Setting up Prometheus</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-sh" data-lang="sh">hal config canary prometheus enable</code></pre></div></div></div></section><section id="_manage_or_view_prometheus_account_for_canary"><h2>Manage or View Prometheus Account for Canary</h2><div class="slide-content"><div class="paragraph"><p>Add a Halyard/Spinnaker account to Prometheus</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-sh" data-lang="sh">hal config canary prometheus account add ACCOUNT --base-url</code></pre></div></div>
<div class="paragraph"><p>Edit a Halyard/Spinnaker account to Prometheus</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-sh" data-lang="sh">hal config canary prometheus account edit ACCOUNT --base-url</code></pre></div></div>
<div class="paragraph"><p>Operations for <code>delete</code> and <code>list</code> are also available</p></div></div></section><section id="_create_a_canary_configuration"><h2>Create a Canary Configuration</h2><div class="slide-content"><div class="ulist"><ul><li><p>Canary configuration is done per <em>application</em></p></li><li><p>Each Application will have one or more configurations</p></li><li><p>Stages are defined separately</p></li></ul></div></div></section><section id="_what_you_will_be_adding_into_a_canary_configuration"><h2>What you will be adding into a Canary Configuration</h2><div class="slide-content"><div class="paragraph"><p>You will be adding the following to your canary configuration:</p></div>
<div class="ulist"><ul><li><p>A name by which a canary stage can choose this configuration</p></li><li><p>The specific metrics to evaluate, and a logical grouping of those metrics</p></li><li><p>Default scoring thresholds (which can be overridden in the canary stage)</p></li><li><p>Optionally, one or more filter templates</p></li></ul></div></div></section><section id="_enabling_canary_at_the_user_level"><h2>Enabling Canary at the User Level</h2><div class="slide-content"><div class="ulist"><ul><li><p>In the Application config, activate the Canary option</p></li><li><p>Do this separately for all applications that will use automated canary analysis</p></li></ul></div>
<div class="imageblock" style=""><img src="https://www.spinnaker.io/guides/user/canary/config/enable_canary.png" alt="enable canary"></div></div></section><section id="_create_your_canary_configuration"><h2>Create your Canary Configuration</h2><div class="slide-content"><div class="ulist"><ul><li><p>Configurations you create within an application are available to all pipelines in that application</p></li><li><p>Unless it is setup that all configurations are available to all applications</p></li></ul></div></div></section><section id="_steps_for_canary_configuration_support"><h2>Steps for Canary Configuration Support</h2></section><section id="_selecting_the_canary_configuration"><h2>Selecting the Canary Configuration</h2><div class="slide-content"><div class="paragraph"><p>Hover over the <strong>Delivery</strong> Tab, select Canary Configs</p></div>
<div class="imageblock" style=""><img src="https://www.spinnaker.io/guides/user/canary/config/delivery_menu_canary.png" alt="delivery menu canary"></div></div></section><section id="_selecting_your_configuration"><h2>Selecting your Configuration</h2><div class="slide-content"><div class="ulist"><ul><li><p>Select <strong>Add Configuration</strong></p></li><li><p>Provide a name and a description. The name is displayed when you show the canary stage on pipeline</p></li><li><p>Select your telemetry provider</p></li></ul></div></div></section><section id="_create_metrics_group"><h2>Create Metrics Group</h2><div class="slide-content"><div class="olist arabic"><ol class="arabic"><li><p>Create groups to determine weights</p></li><li><p>Click Group to create each group you&#8217;ll use. Select the group and click the edit icon</p></li><li><p>An example, would be "cpu" group to add a set of cpu metrics</p></li></ol></div></div></section><section id="_create_metrics"><h2>Create Metrics</h2><div class="slide-content"><div class="olist arabic"><ol class="arabic"><li><p>In the <strong>Metrics</strong> section, add <strong>Metric</strong></p></li><li><p>Select the group to add this metric</p></li><li><p>Give the metric a name</p></li><li><p>Specify whether this metric fails when the value deviates too high or too low, or both compared to the baseline</p></li><li><p>Optionally, choose a filter template</p></li></ol></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code>resource.type = "gce_instance" AND
resource.labels.zone = starts_with("${zone}")</code></pre></div></div></div></section><section id="_identifying_metrics"><h2>Identifying Metrics</h2><div class="slide-content"><div class="ulist"><ul><li><p>Identify the metric you wish to include in this configuration</p></li><li><p>Optionally, if your providers, supports aggregation, you can click <strong>Group by</strong> and enter the metric metadata</p></li><li><p>For example, when you create a metric you can group its time series by resource or metric label. You can group a time series by zone, for example (<code>resource.zone</code>)</p></li></ul></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">When you create a canary configuration, you create metric groups, and scoring thresholds and weights are applied to groups (rather than to specific metrics). But the grouping described in this step is for aggregating metrics before they’re returned to Kayenta.</td></tr></table></div>
<div class="imageblock" style=""><img src="https://www.spinnaker.io/guides/user/canary/config/metric_type_list_cpu.png" alt="metric type list cpu"></div></div></section><section id="_add_filter_template"><h2>Add Filter Template</h2><div class="slide-content"><div class="paragraph"><p>If you are using <em>StackDriver</em> or <em>Prometheus</em> you can add filter templates then assign it to a metric</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Click <strong>Add Template</strong></p></li><li><p>Provide a Name - This is the name by which you can select it when configuring the specific metric.</p></li><li><p>In the Template field, enter an expression using the <em>FreeMarker</em> template language[<a href="https://freemarker.apache.org/docs/dgui_quickstart_template.html" class="bare">https://freemarker.apache.org/docs/dgui_quickstart_template.html</a>]</p></li><li><p>The expression is expanded using the variable bindings specified via the Extended Params in any canary stage that uses this configuration.</p></li><li><p>These variable bindings are also implicitly available: <code>project</code>, <code>resourceType</code>, <code>scope</code>, <code>location</code></p></li></ol></div></div></section><section id="_editing_a_configuration"><h2>Editing a Configuration</h2><div class="slide-content"><div class="ulist"><ul><li><p>In <strong>Delivery</strong> tab select <strong>Canary Configs</strong></p></li><li><p>Select the configuration you would like to edit</p></li></ul></div></div></section><section id="_adding_a_canary_stage"><h2>Adding a Canary Stage</h2></section><section id="_about_canary_stages"><h2>About Canary Stages</h2><div class="slide-content"><div class="paragraph"><p>Canary analysis can be performed over data points collected beginning from the moment of execution and into the future, or it can be performed over a specified time interval.</p></div></div></section><section id="_real_time_analysis"><h2>Real-time Analysis</h2><div class="slide-content"><div class="ulist"><ul><li><p>A real-time analysis means that the canary analysis is performed over a time interval beginning at the moment of execution.</p></li><li><p>The analysis happens for a specified time period, beginning when the stage executes (or after a specified Delay).</p></li><li><p>For Real Time, also specify the number of hours to run (Lifetime).</p></li></ul></div></div></section><section id="_retrospective_analysis"><h2>Retrospective Analysis</h2><div class="slide-content"><div class="ulist"><ul><li><p>In a retrospective analysis the canary analysis is performed over an explicitly specified time interval (likely in the past).</p></li><li><p>Analysis occurs over some specified period. Typically, this is done for a time period in the past, against a baseline deployment and a canary deployment which have already been running before this canary analysis stage starts.</p></li><li><p>Note that this analysis might analyze data for resources which no longer exist, for which there are still published time series.</p></li></ul></div></div></section><section id="_metric_scope"><h2>Metric Scope</h2><div class="slide-content"><div class="paragraph"><p>Metric scope defines:</p></div>
<div class="ulist"><ul><li><p>Where, when, and on what the canary analysis occurs.</p></li><li><p>Specific baseline and canary server groups</p></li><li><p>Start and end times and interval</p></li><li><p>Cloud resource on which the baseline and canary are running</p></li></ul></div></div></section><section id="_defining_the_canary_stage"><h2>Defining the Canary Stage</h2><div class="slide-content"><div class="imageblock" style=""><img src="https://www.spinnaker.io/guides/user/canary/stage/stage_config_analysis.png" alt="stage config analysis"></div></div></section><section id="_defining_the_canary_stage_details"><h2>Defining the Canary Stage Details</h2><div class="slide-content"><div class="ulist"><ul><li><p>In your pipeline click on <strong>Add Stage</strong></p></li><li><p>For type, select <strong>Canary</strong></p></li><li><p>Give it the stage name and depends on field</p></li><li><p>In the analysis type select <strong>Real Time</strong> or <strong>Retrospective</strong></p></li><li><p>Choose a configuration name for the configuration you created before adding this stage</p></li></ul></div></div></section><section id="_defining_the_canary_stage_details_continued"><h2>Defining the Canary Stage Details Continued</h2><div class="slide-content"><div class="ulist"><ul><li><p>Set a delay: How many minutes to wait until warmed up</p></li><li><p>Set an interval: This is how frequently (in minutes) to capture and score the metrics.</p></li><li><p>Lookback Type: Growing or Slowing</p><div class="ulist"><ul><li><p>In a growing analysis, a judgment is taken every [interval] minutes, but each judgment goes all the way back to the beginning of the Lifetime.</p></li><li><p>A sliding Lookback also makes a judgment every [interval], but each judgment only looks at the data from the most recent lookback duration. It would not be unusual for the Interval and the look-back duration to be the same, but they don’t have to be.</p></li></ul></div></li></ul></div></div></section><section id="_the_metric_scope"><h2>The Metric Scope</h2><div class="slide-content"><div class="imageblock" style=""><img src="https://www.spinnaker.io/guides/user/canary/stage/metric_scope.png" alt="metric scope"></div>
<div class="ulist"><ul><li><p>Adjust Scoring Thresholds is needed - The thresholds are pre-populated based on those configured in the main canary config, but you can override them here.</p></li><li><p>Specify the account that you are using for metrics and storage</p></li><li><p>Metric Scope has a magic wand next to the name that automatically resolve to available resources</p></li></ul></div></div></section><section id="_defining_the_canary_stage_details_continued_2"><h2>Defining the Canary Stage Details Continued</h2><div class="slide-content"><div class="ulist"><ul><li><p>Baseline - The server group to treat as the “control” in the canary analysis—that is, the deployment against which to compare the canary deployment.</p></li><li><p>Baseline Region - The region in which the baseline server group is deployed.</p></li><li><p>Canary - The server group to treat as the experiment in the analysis.</p></li><li><p>Canary Region - The region in which that canary server group is deployed.</p></li><li><p>Step - The interval, in seconds, for the metric time series.</p></li><li><p>Start Time and End Time (for retrospective) For a retrospective analysis, the specific time span over which to conduct the analysis.</p></li><li><p>Extended Params - Add any additional parameters, which are specific to the metric sources and which can be used to refine the scope of the analysis. These parameters can provide variable bindings for use in the expansion of custom filter templates specified in the canary config.</p></li></ul></div></div></section><section id="_judgment"><h2>Judgment</h2><div class="slide-content"><div class="paragraph"><p>Judgment goes through two phases:</p></div>
<div class="ulist"><ul><li><p>Data collection</p><div class="ulist"><ul><li><p>Collect data from both baseline and canary deployments</p></li><li><p>Stored in a timeseries database</p></li><li><p>Include a set of tags or annotations that identify deployment</p></li></ul></div></li><li><p>Judgment</p><div class="ulist"><ul><li><p>Compare the metrics from the data collection</p></li><li><p>Renders a pass or fail</p></li><li><p>Can be configured with a "marginal" decision</p></li></ul></div></li></ul></div></div></section><section id="_judgment_phases"><h2>Judgment Phases</h2></section><section id="_data_validation"><h2>Data Validation</h2><div class="slide-content"><div class="ulist"><ul><li><p>Ensures that there is data</p></li><li><p>If no data is found in either baseline or canary, it moves onto the next metric</p></li><li><p>Judge does not fail if there is no data, since some data it&#8217;s ok to have no data</p></li></ul></div></div></section><section id="_data_cleaning"><h2>Data Cleaning</h2><div class="slide-content"><div class="ulist"><ul><li><p>Handling Missing Values</p></li><li><p>Impute values for missing values</p></li><li><p>Optionally, outliers can be removed</p></li></ul></div></div></section><section id="_metric_comparison"><h2>Metric Comparison</h2><div class="slide-content"><div class="ulist"><ul><li><p>This is the step that compares the canary and baseline data for each included metric.</p></li><li><p>Classification indicating there is a significant difference between baseline and canary</p></li><li><p>Each metric is either <em>Pass</em>, <em>High</em>, or <em>Low</em></p></li><li><p>Uses nonparametric statistical test to check for a significant difference between the canary and baseline metrics</p></li></ul></div></div></section><section id="_check_the_score"><h2>Check the score</h2><div class="slide-content"><div class="ulist"><ul><li><p>If 9 out of 10 is "Pass" it is classified as pass if specified in the root configuration</p></li><li><p>Default judge is biased for simplicity- easy to interpret and understand</p></li></ul></div>
<div class="imageblock" style=""><img src="https://www.spinnaker.io/guides/user/canary/judge/metric_classifications.png" alt="metric classifications"></div></div></section></section>
<section><section id="_prometheus"><h2>Prometheus</h2></section><section id="_prometheus_overview"><h2>Prometheus Overview</h2><div class="slide-content"><div class="ulist"><ul><li><p>Prometheus is just one of the available metrics packages that analyzes data from your microservice</p></li><li><p>There are various metrics packages to include in your microservice in a variety of languages</p></li><li><p>The metrics are "scraped" by prometheus and aggregated into reports</p></li></ul></div></div></section><section id="_prometheus_architecture"><h2>Prometheus Architecture</h2><div class="slide-content"><div class="imageblock" style=""><img src="https://prometheus.io/assets/architecture.png" alt="architecture"></div></div></section><section id="_prometheus_setup_in_kubernetes"><h2>Prometheus Setup in Kubernetes</h2><div class="slide-content"><div class="ulist"><ul><li><p>There are various utilities to get Prometheus up and running, and documentation is terrible</p></li><li><p>One of the easier ones, despite horrible documentation, is the Prometheus Operator on Helm(<a href="https://coreos.com/operators/prometheus/docs/latest/user-guides/getting-started.html" class="bare">https://coreos.com/operators/prometheus/docs/latest/user-guides/getting-started.html</a>)</p></li></ul></div></div></section><section id="_prometheus_operator"><h2>Prometheus Operator</h2><div class="slide-content"><div class="imageblock" style=""><img src="https://miro.medium.com/max/3592/1*6KI8wlyWwLwPYgt_SP1CCA.png" alt="1*6KI8wlyWwLwPYgt SP1CCA"></div></div></section><section id="_setup_for_prometheus"><h2>Setup for Prometheus</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-sh" data-lang="sh">helm install &lt;name&gt; stable/prometheus-operator</code></pre></div></div>
<div class="admonitionblock warning"><table><tr><td class="icon"><i class="fa fa-warning" title="Warning"></i></td><td class="content">Ensure that you are in the right context. For canary testing you would need to be in <code>staging</code></td></tr></table></div></div></section><section id="_create_a_service_monitor"><h2>Create a Service Monitor</h2><div class="slide-content"><div class="ulist"><ul><li><p>By default, Prometheus is install in the <code>default</code> namespace</p></li><li><p><code>namespaceSelector</code> will look for metrics in other <code>namespaces</code></p></li><li><p>This <code>ServiceMonitor</code> needs to be deployed in the <code>default</code> namespace</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  labels:
    release: lasertag
  name: teama-microservice-service-monitor
spec:
  endpoints:
    - interval: 30s
      path: /metrics
      port: web
  namespaceSelector:
    matchNames:
      - microservices
  selector:
    matchLabels:
      app: teama-microservice-service</code></pre></div></div></div></section><section id="_create_a_nodeport_or_loadbalancer"><h2>Create a <code>NodePort</code> or <code>LoadBalancer</code></h2><div class="slide-content"><div class="paragraph"><p>Once established, deploy a <code>NodePort</code> or <code>LoadBalancer</code></p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-sh" data-lang="sh">apiVersion: v1
kind: Service
metadata:
  name: prometheus
spec:
  type: (NodePort | LoadBalancer)
  ports:
  - name: web
    nodePort: 30900
    port: 9090
    protocol: TCP
    targetPort: web
  selector:
    app: prometheus</code></pre></div></div>
<div class="admonitionblock warning"><table><tr><td class="icon"><i class="fa fa-warning" title="Warning"></i></td><td class="content">Choose <code>NodePort</code> or <code>LoadBalancer</code>,  <code>(NodePort | LoadBalancer)</code> is not a valid option</td></tr></table></div></div></section></section>
<section id="_lab_4_advanced_features"><h2>Lab 4: Advanced Features</h2></section>
<section id="_final_poll"><h2>Final Poll</h2><div class="slide-content"><div class="paragraph"><p>Please take time to fill in this final poll: <a href="https://forms.gle/MXAjQaNEZEDfsb46A" class="bare">https://forms.gle/MXAjQaNEZEDfsb46A</a></p></div></div></section>
<section id="_conclusion"><h2>Conclusion</h2><div class="slide-content"><div class="ulist"><ul><li><p>Dev-ops is hard, requires a lot of knowledge in:</p><div class="ulist"><ul><li><p>Command line programming</p></li><li><p>Kubernetes</p></li><li><p>Prometheus</p></li><li><p>Multiple Languages</p></li></ul></div></li></ul></div>
<div class="paragraph"><p>You will need to be creative</p></div></div></section></div></div><script src="reveal.js/js/reveal.js"></script><script>Array.prototype.slice.call(document.querySelectorAll('.slides section')).forEach(function(slide) {
  if (slide.getAttribute('data-background-color')) return;
  // user needs to explicitly say he wants CSS color to override otherwise we might break custom css or theme (#226)
  if (!(slide.classList.contains('canvas') || slide.classList.contains('background'))) return;
  var bgColor = getComputedStyle(slide).backgroundColor;
  if (bgColor !== 'rgba(0, 0, 0, 0)' && bgColor !== 'transparent') {
    slide.setAttribute('data-background-color', bgColor);
    slide.style.backgroundColor = 'transparent';
  }
});

// More info about config & dependencies:
// - https://github.com/hakimel/reveal.js#configuration
// - https://github.com/hakimel/reveal.js#dependencies
Reveal.initialize({
  // Display presentation control arrows
  controls: true,
  // Help the user learn the controls by providing hints, for example by
  // bouncing the down arrow when they first encounter a vertical slide
  controlsTutorial: true,
  // Determines where controls appear, "edges" or "bottom-right"
  controlsLayout: 'bottom-right',
  // Visibility rule for backwards navigation arrows; "faded", "hidden"
  // or "visible"
  controlsBackArrows: 'faded',
  // Display a presentation progress bar
  progress: true,
  // Display the page number of the current slide
  slideNumber: false,
  // Control which views the slide number displays on
  showSlideNumber: 'all',
  // Add the current slide number to the URL hash so that reloading the
  // page/copying the URL will return you to the same slide
  hash: true,
  // Push each slide change to the browser history. Implies `hash: true`
  history: false,
  // Enable keyboard shortcuts for navigation
  keyboard: true,
  // Enable the slide overview mode
  overview: true,
  // Vertical centering of slides
  center: true,
  // Enables touch navigation on devices with touch input
  touch: true,
  // Loop the presentation
  loop: false,
  // Change the presentation direction to be RTL
  rtl: false,
  // See https://github.com/hakimel/reveal.js/#navigation-mode
  navigationMode: 'default',
  // Randomizes the order of slides each time the presentation loads
  shuffle: false,
  // Turns fragments on and off globally
  fragments: true,
  // Flags whether to include the current fragment in the URL,
  // so that reloading brings you to the same fragment position
  fragmentInURL: false,
  // Flags if the presentation is running in an embedded mode,
  // i.e. contained within a limited portion of the screen
  embedded: false,
  // Flags if we should show a help overlay when the questionmark
  // key is pressed
  help: true,
  // Flags if speaker notes should be visible to all viewers
  showNotes: false,
  // Global override for autolaying embedded media (video/audio/iframe)
  // - null: Media will only autoplay if data-autoplay is present
  // - true: All media will autoplay, regardless of individual setting
  // - false: No media will autoplay, regardless of individual setting
  autoPlayMedia: null,
  // Global override for preloading lazy-loaded iframes
  // - null: Iframes with data-src AND data-preload will be loaded when within
  //   the viewDistance, iframes with only data-src will be loaded when visible
  // - true: All iframes with data-src will be loaded when within the viewDistance
  // - false: All iframes with data-src will be loaded only when visible
  preloadIframes: null,
  // Number of milliseconds between automatically proceeding to the
  // next slide, disabled when set to 0, this value can be overwritten
  // by using a data-autoslide attribute on your slides
  autoSlide: 0,
  // Stop auto-sliding after user input
  autoSlideStoppable: true,
  // Use this method for navigation when auto-sliding
  autoSlideMethod: Reveal.navigateNext,
  // Specify the average time in seconds that you think you will spend
  // presenting each slide. This is used to show a pacing timer in the
  // speaker view
  defaultTiming: 120,
  // Specify the total time in seconds that is available to
  // present.  If this is set to a nonzero value, the pacing
  // timer will work out the time available for each slide,
  // instead of using the defaultTiming value
  totalTime: 0,
  // Specify the minimum amount of time you want to allot to
  // each slide, if using the totalTime calculation method.  If
  // the automated time allocation causes slide pacing to fall
  // below this threshold, then you will see an alert in the
  // speaker notes window
  minimumTimePerSlide: 0,
  // Enable slide navigation via mouse wheel
  mouseWheel: false,
  // Hide cursor if inactive
  hideInactiveCursor: true,
  // Time before the cursor is hidden (in ms)
  hideCursorTime: 5000,
  // Hides the address bar on mobile devices
  hideAddressBar: true,
  // Opens links in an iframe preview overlay
  // Add `data-preview-link` and `data-preview-link="false"` to customise each link
  // individually
  previewLinks: false,
  // Transition style (e.g., none, fade, slide, convex, concave, zoom)
  transition: 'slide',
  // Transition speed (e.g., default, fast, slow)
  transitionSpeed: 'default',
  // Transition style for full page slide backgrounds (e.g., none, fade, slide, convex, concave, zoom)
  backgroundTransition: 'fade',
  // Number of slides away from the current that are visible
  viewDistance: 3,
  // Number of slides away from the current that are visible on mobile
  // devices. It is advisable to set this to a lower number than
  // viewDistance in order to save resources.
  mobileViewDistance: 3,
  // Parallax background image (e.g., "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'")
  parallaxBackgroundImage: '',
  // Parallax background size in CSS syntax (e.g., "2100px 900px")
  parallaxBackgroundSize: '',
  // Number of pixels to move the parallax background per slide
  // - Calculated automatically unless specified
  // - Set to 0 to disable movement along an axis
  parallaxBackgroundHorizontal: null,
  parallaxBackgroundVertical: null,
  // The display mode that will be used to show slides
  display: 'block',

  // The "normal" size of the presentation, aspect ratio will be preserved
  // when the presentation is scaled to fit different resolutions. Can be
  // specified using percentage units.
  width: 960,
  height: 700,

  // Factor of the display size that should remain empty around the content
  margin: 0.1,

  // Bounds for smallest/largest possible scale to apply to content
  minScale: 0.2,
  maxScale: 1.5,

  // PDF Export Options
  // Put each fragment on a separate page
  pdfSeparateFragments: true,
  // For slides that do not fit on a page, max number of pages
  pdfMaxPagesPerSlide: 1,

  // Optional libraries used to extend on reveal.js
  dependencies: [
      { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true },
      { src: 'reveal.js/plugin/notes/notes.js', async: true }
  ],

  

});</script><script>var dom = {};
dom.slides = document.querySelector('.reveal .slides');

function getRemainingHeight(element, slideElement, height) {
  height = height || 0;
  if (element) {
    var newHeight, oldHeight = element.style.height;
    // Change the .stretch element height to 0 in order find the height of all
    // the other elements
    element.style.height = '0px';
    // In Overview mode, the parent (.slide) height is set of 700px.
    // Restore it temporarily to its natural height.
    slideElement.style.height = 'auto';
    newHeight = height - slideElement.offsetHeight;
    // Restore the old height, just in case
    element.style.height = oldHeight + 'px';
    // Clear the parent (.slide) height. .removeProperty works in IE9+
    slideElement.style.removeProperty('height');
    return newHeight;
  }
  return height;
}

function layoutSlideContents(width, height) {
  // Handle sizing of elements with the 'stretch' class
  toArray(dom.slides.querySelectorAll('section .stretch')).forEach(function (element) {
    // Determine how much vertical space we can use
    var limit = 5; // hard limit
    var parent = element.parentNode;
    while (parent.nodeName !== 'SECTION' && limit > 0) {
      parent = parent.parentNode;
      limit--;
    }
    if (limit === 0) {
      // unable to find parent, aborting!
      return;
    }
    var remainingHeight = getRemainingHeight(element, parent, height);
    // Consider the aspect ratio of media elements
    if (/(img|video)/gi.test(element.nodeName)) {
      var nw = element.naturalWidth || element.videoWidth, nh = element.naturalHeight || element.videoHeight;
      var es = Math.min(width / nw, remainingHeight / nh);
      element.style.width = (nw * es) + 'px';
      element.style.height = (nh * es) + 'px';
    } else {
      element.style.width = width + 'px';
      element.style.height = remainingHeight + 'px';
    }
  });
}

function toArray(o) {
  return Array.prototype.slice.call(o);
}

Reveal.addEventListener('slidechanged', function () {
  layoutSlideContents(960, 700)
});
Reveal.addEventListener('ready', function () {
  layoutSlideContents(960, 700)
});
Reveal.addEventListener('resize', function () {
  layoutSlideContents(960, 700)
});</script></body></html>